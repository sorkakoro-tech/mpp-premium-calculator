<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–µ–º–∏–∏ –ú–ü–ü</title>
<base href="/mpp-premium-calculator/">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
:root {
  --primary: #2c3e50;
  --secondary: #3498db;
  --accent: #e74c3c;
  --success: #27ae60;
  --warning: #f39c12;
  --light: #ecf0f1;
  --dark: #34495e;
  --bg-color: #ffffff;
  --text-color: #333333;
  --card-bg: #f8f9fa;
  --border-color: #ddd;
}

[data-theme="dark"] {
  --primary: #3498db;
  --secondary: #2980b9;
  --accent: #e74c3c;
  --success: #27ae60;
  --warning: #f39c12;
  --light: #2c3e50;
  --dark: #ecf0f1;
  --bg-color: #1a1a1a;
  --text-color: #ffffff;
  --card-bg: #2d2d2d;
  --border-color: #444;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background: var(--bg-color);
  min-height: 100vh;
  color: var(--text-color);
  font-size: 16px;
  transition: all 0.3s ease;
}

.container {
  display: none;
  max-width: 100%;
  margin: 0 auto;
  background: var(--bg-color);
  border-radius: 15px;
  overflow: hidden;
  position: relative;
  transition: all 0.3s ease;
  padding-bottom: 70px;
}

header {
  background: var(--primary);
  color: white;
  padding: 15px 10px;
  text-align: center;
  position: relative;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-left {
  flex: 1;
  text-align: left;
}

.header-center {
  flex: 2;
  text-align: center;
}

.header-right {
  flex: 1;
  text-align: right;
}

.menu-button {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
  border-radius: 5px;
  transition: all 0.3s;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.menu-button:hover {
  background: rgba(255, 255, 255, 0.1);
}

.header-center h1 {
  font-size: 20px;
  margin-bottom: 5px;
}

.header-center p {
  opacity: 0.9;
  font-size: 12px;
}

.user-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  color: white;
  font-size: 14px;
  margin-top: 10px;
}

.user-avatar {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  background: var(--secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
}

/* –ú–µ–Ω—é */
.menu-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 2000;
  animation: fadeIn 0.3s ease;
}

.menu-container {
  position: fixed;
  top: 0;
  right: -300px;
  width: 280px;
  height: 100%;
  background: var(--card-bg);
  box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
  z-index: 2001;
  transition: right 0.3s ease;
  overflow-y: auto;
  padding: 20px 0;
}

.menu-container.active {
  right: 0;
}

.menu-header {
  padding: 0 20px 20px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 15px;
}

.menu-user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.menu-user-details h3 {
  font-size: 16px;
  margin-bottom: 2px;
  color: var(--text-color);
}

.menu-user-details p {
  font-size: 12px;
  opacity: 0.8;
  color: var(--text-color);
}

.menu-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  color: var(--text-color);
  font-size: 20px;
  cursor: pointer;
}

.menu-items {
  list-style: none;
  padding: 0;
}

.menu-item {
  padding: 15px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  color: var(--text-color);
  text-decoration: none;
  transition: all 0.3s;
  border-left: 4px solid transparent;
  cursor: pointer;
}

.menu-item:hover {
  background: rgba(52, 152, 219, 0.1);
  border-left-color: var(--secondary);
}

.menu-item.active {
  background: rgba(52, 152, 219, 0.2);
  border-left-color: var(--secondary);
  font-weight: bold;
}

.menu-item i {
  width: 24px;
  text-align: center;
  font-size: 18px;
}

.menu-divider {
  height: 1px;
  background: var(--border-color);
  margin: 10px 20px;
}

.menu-footer {
  padding: 20px;
  margin-top: 20px;
  border-top: 1px solid var(--border-color);
  text-align: center;
}

.theme-switch {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px 20px;
  cursor: pointer;
}

.theme-switch:hover {
  background: rgba(52, 152, 219, 0.1);
}

.theme-label {
  display: flex;
  align-items: center;
  gap: 12px;
}

.theme-label i {
  width: 24px;
  text-align: center;
  font-size: 18px;
}

.theme-toggle-switch {
  position: relative;
  width: 50px;
  height: 24px;
}

.theme-toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.theme-toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

.theme-toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.theme-toggle-switch input:checked + .theme-toggle-slider {
  background-color: var(--secondary);
}

.theme-toggle-switch input:checked + .theme-toggle-slider:before {
  transform: translateX(26px);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@media (max-width: 768px) {
  .menu-container {
    width: 100%;
    right: -100%;
  }
  
  .header-center h1 {
    font-size: 18px;
  }
  
  .header-center p {
    font-size: 11px;
  }
}

@media (max-width: 480px) {
  .header-center h1 {
    font-size: 16px;
  }
  
  .header-center p {
    display: none;
  }
}

/* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ */
.home-welcome-card {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 25px 20px;
  border-radius: 15px;
  margin: 15px 10px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.home-welcome-title {
  font-size: 28px;
  margin-bottom: 10px;
  font-weight: bold;
}

.home-welcome-text {
  font-size: 16px;
  opacity: 0.9;
  margin-bottom: 20px;
  line-height: 1.5;
}

.quote-card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 12px;
  margin: 15px 10px;
  text-align: center;
  border: 1px solid var(--border-color);
  position: relative;
}

.quote-text {
  font-size: 16px;
  font-style: italic;
  margin-bottom: 10px;
  color: var(--text-color);
  line-height: 1.4;
}

.quote-author {
  font-size: 14px;
  color: var(--secondary);
  font-weight: 600;
}

.quote-icon {
  position: absolute;
  top: 10px;
  left: 10px;
  color: var(--secondary);
  font-size: 20px;
  opacity: 0.5;
}

.premium-forecast-card {
  background: linear-gradient(135deg, var(--success), #2ecc71);
  color: white;
  padding: 20px;
  border-radius: 12px;
  margin: 15px 10px;
  text-align: center;
}

.premium-forecast-title {
  font-size: 18px;
  margin-bottom: 15px;
  font-weight: 600;
}

.premium-forecast-amount {
  font-size: 36px;
  font-weight: bold;
  margin-bottom: 10px;
  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
}

.premium-forecast-period {
  font-size: 14px;
  opacity: 0.9;
  margin-bottom: 15px;
}

.premium-forecast-progress {
  background: rgba(255, 255, 255, 0.2);
  height: 8px;
  border-radius: 4px;
  margin-bottom: 10px;
  overflow: hidden;
}

.premium-forecast-progress-bar {
  height: 100%;
  background: white;
  border-radius: 4px;
  transition: width 1s ease;
}

.premium-forecast-comparison {
  font-size: 14px;
  margin-top: 10px;
  opacity: 0.9;
}

.quick-stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin: 15px 10px;
}

.quick-stat-card {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all 0.3s;
}

.quick-stat-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.quick-stat-icon {
  font-size: 24px;
  margin-bottom: 8px;
  color: var(--secondary);
}

.quick-stat-value {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 5px;
  color: var(--text-color);
}

.quick-stat-label {
  font-size: 12px;
  color: var(--text-color);
  opacity: 0.7;
}

.start-calculation-btn {
  display: block;
  margin: 20px 10px;
  padding: 18px;
  background: linear-gradient(135deg, var(--secondary), #2980b9);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
  text-decoration: none;
}

.start-calculation-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
}

.start-calculation-btn i {
  margin-right: 10px;
}

/* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ó–û–ù–´ –†–û–°–¢–ê */
.growth-zone-section {
  margin-top: 25px;
  padding-top: 20px;
  border-top: 2px solid var(--border-color);
}

.growth-stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.growth-stat-card {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border-color);
}

.growth-stat-title {
  font-size: 14px;
  margin-bottom: 8px;
  color: var(--text-color);
  opacity: 0.8;
}

.growth-stat-value {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 5px;
}

.growth-stat-value.positive {
  color: var(--success);
}

.growth-stat-value.negative {
  color: var(--accent);
}

.growth-stat-value.neutral {
  color: var(--warning);
}

.growth-stat-comparison {
  font-size: 12px;
  color: var(--text-color);
  opacity: 0.7;
}

.weak-spots-container {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 12px;
  margin-top: 20px;
  border: 1px solid var(--border-color);
}

.weak-spots-title {
  font-size: 18px;
  margin-bottom: 15px;
  color: var(--primary);
  display: flex;
  align-items: center;
}

.weak-spots-title i {
  margin-right: 10px;
  color: var(--accent);
}

.weak-spot-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border-color);
}

.weak-spot-item:last-child {
  border-bottom: none;
}

.weak-spot-info {
  flex: 1;
}

.weak-spot-name {
  font-weight: 600;
  color: var(--text-color);
  margin-bottom: 3px;
}

.weak-spot-description {
  font-size: 12px;
  color: var(--text-color);
  opacity: 0.7;
}

.weak-spot-value {
  font-weight: bold;
  margin-left: 15px;
  color: var(--accent);
}

.weak-spot-percent {
  font-size: 12px;
  color: var(--accent);
  margin-left: 5px;
}

.recommendations-container {
  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  padding: 20px;
  border-radius: 12px;
  margin-top: 20px;
  border: 1px solid var(--border-color);
}

.recommendations-title {
  font-size: 18px;
  margin-bottom: 15px;
  color: var(--primary);
  display: flex;
  align-items: center;
}

.recommendations-title i {
  margin-right: 10px;
  color: var(--success);
}

.recommendation-item {
  display: flex;
  align-items: flex-start;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.recommendation-item:last-child {
  border-bottom: none;
}

.recommendation-icon {
  font-size: 16px;
  color: var(--success);
  margin-right: 12px;
  margin-top: 2px;
}

.recommendation-text {
  flex: 1;
  color: var(--text-color);
  font-size: 14px;
  line-height: 1.4;
}

.growth-chart-container {
  height: 200px;
  margin: 20px 0;
  position: relative;
}

.profile-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 2px solid var(--border-color);
  padding-bottom: 10px;
  overflow-x: auto;
}

.profile-tab {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background: var(--card-bg);
  color: var(--text-color);
  cursor: pointer;
  transition: all 0.3s;
  font-size: 16px;
  white-space: nowrap;
}

.profile-tab.active {
  background: var(--secondary);
  color: white;
}

.profile-content {
  display: none;
}

.profile-content.active {
  display: block;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
.calculator-container {
  padding: 15px 10px;
}

.section {
  margin-bottom: 20px;
  padding: 12px;
  border-radius: 10px;
  background: var(--card-bg);
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.section-title {
  color: var(--primary);
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--secondary);
  font-size: 18px;
  display: flex;
  align-items: center;
}

.section-title i {
  margin-right: 8px;
  font-size: 20px;
}

.form-group {
  margin-bottom: 12px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: var(--text-color);
  font-size: 14px;
}

input, select, textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.3s;
  background: var(--bg-color);
  color: var(--text-color);
}

input:focus, select:focus, textarea:focus {
  border-color: var(--secondary);
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
  outline: none;
}

.plan-fact-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 12px;
}

.credit-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 12px;
  align-items: end;
  padding: 12px;
  background: var(--card-bg);
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  border: 1px solid var(--border-color);
}

.btn {
  background: var(--secondary);
  color: white;
  border: none;
  padding: 14px 16px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-height: 50px;
  width: 100%;
  margin-bottom: 8px;
}

.btn:hover {
  background: #2980b9;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.btn i {
  margin-right: 8px;
}

.btn-remove {
  background: var(--accent);
  padding: 10px;
  font-size: 14px;
}

.btn-remove:hover {
  background: #c0392b;
}

.result-card {
  background: var(--card-bg);
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
  border-left: 4px solid var(--success);
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  border: 1px solid var(--border-color);
}

.result-title {
  font-weight: bold;
  margin-bottom: 8px;
  color: var(--primary);
  font-size: 16px;
}

.result-value {
  font-size: 16px;
  font-weight: bold;
  color: var(--success);
}

.final-result {
  background: linear-gradient(135deg, var(--success), #2ecc71);
  color: white;
  padding: 20px 12px;
  text-align: center;
  border-radius: 10px;
  margin-top: 15px;
}

.final-amount {
  font-size: 28px;
  font-weight: bold;
  margin: 8px 0;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}

.calculation-steps {
  background: var(--card-bg);
  padding: 12px;
  border-radius: 8px;
  margin-top: 15px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  border: 1px solid var(--border-color);
}

.step {
  margin-bottom: 12px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border-color);
}

.step:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.step-title {
  font-weight: bold;
  margin-bottom: 5px;
  color: var(--text-color);
}

.nav-tabs {
  display: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é */
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.loader {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  color: white;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  flex-direction: column;
}

.loader-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
  margin-bottom: 15px;
}

.loader-text {
  font-size: 16px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.error-message {
  background: var(--accent);
  color: white;
  padding: 12px;
  border-radius: 8px;
  margin: 10px 0;
  display: none;
}

.success-message {
  background: var(--success);
  color: white;
  padding: 12px;
  border-radius: 8px;
  margin: 10px 0;
  display: none;
}

@media (max-width: 360px) {
  body {
    font-size: 14px;
    padding: 5px;
  }
  .calculator-container {
    padding: 10px 5px;
  }
  .section {
    padding: 10px;
    margin-bottom: 15px;
  }
  .section-title {
    font-size: 16px;
  }
  input, select {
    padding: 10px;
    font-size: 16px;
  }
  .btn {
    padding: 12px;
    font-size: 16px;
  }
  .final-amount {
    font-size: 24px;
  }
}

.week-selector {
  display: flex;
  gap: 5px;
  margin-bottom: 15px;
}

.week-btn {
  flex: 1;
  padding: 8px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-color);
  border-radius: 5px;
  cursor: pointer;
}

.week-btn.active {
  background: var(--secondary);
  color: white;
}

.leaderboard-item {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  background: var(--card-bg);
  margin-bottom: 5px;
  border-radius: 5px;
  border: 1px solid var(--border-color);
}

.rank {
  font-weight: bold;
  width: 30px;
}

.name {
  flex: 1;
}

.value {
  font-weight: bold;
  color: var(--success);
}

.badge-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.badge {
  background: var(--card-bg);
  padding: 15px 10px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border-color);
}

.badge-icon {
  font-size: 24px;
  margin-bottom: 5px;
  color: var(--secondary);
}

.badge-name {
  font-weight: bold;
  font-size: 12px;
  margin-bottom: 3px;
}

.badge-desc {
  font-size: 10px;
  opacity: 0.7;
}

.badge.locked {
  opacity: 0.5;
}

.badge.unlocked {
  border-color: var(--success);
}

.monthly-report-section {
  margin-top: 20px;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: var(--bg-color);
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 10px;
}

.modal-title {
  font-size: 18px;
  font-weight: bold;
  color: var(--primary);
}

.close-modal {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-color);
}

.week-options {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-bottom: 15px;
}

.week-option {
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.week-option:hover {
  border-color: var(--secondary);
  background: rgba(52, 152, 219, 0.1);
}

.week-option.selected {
  border-color: var(--secondary);
  background: rgba(52, 152, 219, 0.2);
}

.week-range {
  font-weight: bold;
  margin-bottom: 5px;
}

.week-days {
  font-size: 12px;
  opacity: 0.7;
}

.alert {
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 15px;
  background: var(--warning);
  color: white;
}

.alert i {
  margin-right: 8px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}

.detail-label {
  color: var(--text-color);
}

.detail-value {
  font-weight: bold;
  color: var(--success);
}

.strata-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  background: var(--secondary);
  color: white;
  font-size: 12px;
  margin-left: 5px;
}

.multiplier-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  background: var(--success);
  color: white;
  font-size: 12px;
  margin-left: 5px;
}

.points-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  background: var(--warning);
  color: white;
  font-size: 12px;
  margin-left: 5px;
}

.final-strata-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 16px;
  background: var(--primary);
  color: white;
  font-size: 14px;
  font-weight: bold;
  margin-left: 10px;
}

.premium-structure {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.chart-container {
  position: relative;
  width: 100%;
  height: 250px;
  margin: 15px auto;
}

.premium-chart {
  width: 100%;
  height: 100%;
}

.chart-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  background: var(--bg-color);
  border-radius: 50%;
  width: 80px;
  height: 80px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  border: 2px solid var(--border-color);
}

.chart-total {
  font-weight: bold;
  font-size: 14px;
  color: var(--primary);
}

.chart-percent {
  font-size: 12px;
  color: var(--text-color);
  opacity: 0.8;
}

.chart-legend {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  width: 100%;
  margin-top: 15px;
}

.legend-item {
  display: flex;
  align-items: center;
  font-size: 12px;
  padding: 5px;
  border-radius: 5px;
  background: var(--card-bg);
}

.legend-color {
  width: 15px;
  height: 15px;
  border-radius: 3px;
  margin-right: 8px;
}

.legend-label {
  flex: 1;
}

.legend-value {
  font-weight: bold;
  color: var(--success);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
.admin-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.stat-card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border-color);
}

.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: var(--secondary);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 14px;
  opacity: 0.8;
}

.admin-table-container {
  overflow-x: auto;
  margin-top: 15px;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--card-bg);
}

.admin-table th,
.admin-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
}

.admin-table th {
  background: var(--primary);
  color: white;
  font-weight: 600;
}

.admin-table tr:hover {
  background: rgba(52, 152, 219, 0.1);
}

.admin-controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.btn-warning {
  background: var(--warning);
}

.btn-warning:hover {
  background: #e67e22;
}

.btn-danger {
  background: var(--accent);
}

.btn-danger:hover {
  background: #c0392b;
}

.user-role-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 10px;
  margin-left: 5px;
}

.role-admin {
  background: #e74c3c;
  color: white;
}

.role-mpp {
  background: #3498db;
  color: white;
}

.admin-user-controls {
  display: flex;
  gap: 5px;
}

.admin-user-btn {
  padding: 4px 8px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.btn-promote {
  background: #27ae60;
  color: white;
}

.btn-demote {
  background: #e74c3c;
  color: white;
}

/* –û—Ç—á–µ—Ç—ã –∏ –ø—Ä–æ—Ñ–∏–ª—å */
.report-type-selector {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.report-type-btn {
  flex: 1;
  padding: 10px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-color);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}

.report-type-btn.active {
  background: var(--secondary);
  color: white;
  border-color: var(--secondary);
}

.report-form {
  display: none;
}

.report-form.active {
  display: block;
}

.month-selector {
  margin-bottom: 15px;
}

.month-select {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background: var(--bg-color);
  color: var(--text-color);
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-bottom: 15px;
}

.profile-stat {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  border: 1px solid var(--border-color);
}

.profile-stat-value {
  font-size: 18px;
  font-weight: bold;
  color: var(--secondary);
  margin-bottom: 5px;
}

.profile-stat-label {
  font-size: 12px;
  opacity: 0.8;
}

.premium-history {
  margin-top: 15px;
}

.history-item {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  background: var(--card-bg);
  margin-bottom: 5px;
  border-radius: 5px;
  border: 1px solid var(--border-color);
}

.history-month {
  font-weight: bold;
}

.history-premium {
  font-weight: bold;
  color: var(--success);
}

.leaderboard-period-selector {
  display: flex;
  gap: 5px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.period-btn {
  flex: 1;
  padding: 8px;
  border: 1px solid var(--border-color);
  background: var(--card-bg);
  color: var(--text-color);
  border-radius: 5px;
  cursor: pointer;
  min-width: 100px;
}

.period-btn.active {
  background: var(--secondary);
  color: white;
}

.last-month-leaderboard {
  margin-top: 20px;
  padding-top: 15px;
  border-top: 2px solid var(--border-color);
}

/* –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–º–∏–∏ */
.edit-premium-btn {
  background: none;
  border: none;
  color: var(--secondary);
  cursor: pointer;
  margin-left: 8px;
  font-size: 14px;
}

.edit-premium-btn:hover {
  color: var(--primary);
}

.no-report {
  color: var(--accent);
  font-style: italic;
}

@media (max-width: 768px) {
  .admin-table {
    font-size: 14px;
  }
  
  .admin-table th,
  .admin-table td {
    padding: 8px 6px;
  }
  
  .admin-controls {
    flex-direction: column;
  }
  
  .admin-user-controls {
    flex-direction: column;
  }
  
  .report-type-selector {
    flex-direction: column;
  }
  
  .leaderboard-period-selector {
    flex-direction: column;
  }
  
  .period-btn {
    min-width: auto;
  }
}

/* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
.admin-plans-form {
  margin-top: 20px;
}

.plan-input-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-bottom: 15px;
}

.plan-input {
  background: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 12px;
}

.plan-input label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-color);
}

.plan-input input {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  font-size: 16px;
  background: var(--bg-color);
  color: var(--text-color);
}

.admin-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 2px solid var(--border-color);
  padding-bottom: 10px;
}

.admin-tab {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background: var(--card-bg);
  color: var(--text-color);
  cursor: pointer;
  transition: all 0.3s;
  font-size: 16px;
}

.admin-tab.active {
  background: var(--secondary);
  color: white;
}

.admin-content {
  display: none;
}

.admin-content.active {
  display: block;
}

.visits-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.visit-stat-card {
  background: var(--card-bg);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border-color);
}

.visit-stat-value {
  font-size: 24px;
  font-weight: bold;
  color: var(--secondary);
  margin-bottom: 5px;
}

.visit-stat-label {
  font-size: 14px;
  opacity: 0.8;
}

.reports-summary {
  margin-top: 20px;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.summary-card {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 8px;
  border: 1px solid var(--border-color);
}

.summary-title {
  font-weight: bold;
  margin-bottom: 10px;
  color: var(--primary);
}

.summary-value {
  font-size: 18px;
  font-weight: bold;
  color: var(--success);
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö */
.changes-notification {
  background: linear-gradient(135deg, #ffd700, #ffa500);
  color: #333;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  border: 1px solid #ffa500;
  box-shadow: 0 3px 10px rgba(255, 165, 0, 0.2);
}

.changes-header {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.changes-header i {
  font-size: 20px;
  margin-right: 10px;
  color: #333;
}

.changes-title {
  font-weight: bold;
  font-size: 16px;
}

.changes-content {
  font-size: 14px;
  line-height: 1.4;
}

.changes-date {
  font-size: 12px;
  opacity: 0.7;
  margin-top: 8px;
  text-align: right;
}

/* –†–µ–∫–æ—Ä–¥—ã –ø—Ä–æ–¥–∞–∂ */
.records-container {
  margin-top: 20px;
}

.record-item {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
  border: 1px solid var(--border-color);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.record-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border-color);
}

.record-title {
  font-weight: bold;
  font-size: 16px;
  color: var(--primary);
}

.record-value {
  font-size: 18px;
  font-weight: bold;
  color: var(--success);
}

.record-user {
  font-size: 14px;
  color: var(--text-color);
  margin-top: 5px;
}

.record-form {
  background: var(--card-bg);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  border: 1px solid var(--border-color);
}

.record-form-title {
  font-weight: bold;
  margin-bottom: 15px;
  color: var(--primary);
  font-size: 16px;
}

.record-input-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  margin-bottom: 15px;
}

.record-input {
  margin-bottom: 10px;
}

.record-input label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
  color: var(--text-color);
  font-size: 14px;
}

.record-input input, .record-input select {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  font-size: 14px;
  background: var(--bg-color);
  color: var(--text-color);
}

.record-btn {
  background: var(--secondary);
  color: white;
  border: none;
  padding: 12px 20px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  margin-top: 10px;
}

.record-btn:hover {
  background: #2980b9;
}

.record-btn i {
  margin-right: 8px;
}

/* –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */
.custom-select-wrapper {
  position: relative;
  width: 100%;
}

.search-input-container {
  position: relative;
  width: 100%;
}

.search-input {
  width: 100%;
  padding: 12px 40px 12px 12px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background: var(--bg-color);
  color: var(--text-color);
}

.search-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-color);
  opacity: 0.7;
}

.search-results {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--bg-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  max-height: 200px;
  overflow-y: auto;
  z-index: 1000;
  display: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.search-result-item {
  padding: 10px 12px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-color);
  transition: all 0.2s;
}

.search-result-item:hover {
  background: var(--secondary);
  color: white;
}

.search-result-item:last-child {
  border-bottom: none;
}

.no-results {
  padding: 10px 12px;
  color: var(--text-color);
  opacity: 0.7;
  font-style: italic;
}

.selected-user {
  margin-top: 10px;
  padding: 10px;
  background: var(--card-bg);
  border-radius: 8px;
  border: 1px solid var(--border-color);
  font-weight: bold;
  color: var(--success);
}

@media (max-width: 768px) {
  .record-input-group {
    grid-template-columns: 1fr;
  }
  
  .quick-stats-grid {
    grid-template-columns: 1fr;
  }
  
  .growth-stats-grid {
    grid-template-columns: 1fr;
  }
  
  .profile-tabs {
    flex-wrap: nowrap;
    overflow-x: auto;
  }
  
  .profile-tab {
    padding: 8px 12px;
    font-size: 14px;
  }
}
</style>
</head>
<body>
<!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div class="loader" id="globalLoader">
  <div class="loader-spinner"></div>
  <div class="loader-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ —É—Å–ø–µ—Ö–µ -->
<div class="error-message" id="errorMessage"></div>
<div class="success-message" id="successMessage"></div>

<!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
<div class="menu-overlay" id="menuOverlay"></div>
<div class="menu-container" id="menuContainer">
  <div class="menu-header">
    <div class="menu-user-info">
      <div class="user-avatar" id="menuUserAvatar">U</div>
      <div class="menu-user-details">
        <h3 id="menuUserName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
        <p id="menuUserRole">–ú–ü–ü</p>
      </div>
    </div>
  </div>
  
  <button class="menu-close" id="menuClose">
    <i class="fas fa-times"></i>
  </button>
  
  <ul class="menu-items">
    <li class="menu-item active" data-tab="home-tab">
      <i class="fas fa-home"></i>
      <span>üè† –ì–ª–∞–≤–Ω–∞—è</span>
    </li>
    <li class="menu-item" data-tab="calculator-tab">
      <i class="fas fa-calculator"></i>
      <span>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
    </li>
    <li class="menu-item" data-tab="reports-tab">
      <i class="fas fa-chart-bar"></i>
      <span>üìä –û—Ç—á–µ—Ç—ã</span>
    </li>
    <li class="menu-item" data-tab="leaderboard-tab">
      <i class="fas fa-crown"></i>
      <span>üèÜ –¢–æ–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
    </li>
    <li class="menu-item" data-tab="profile-tab">
      <i class="fas fa-user"></i>
      <span>üë§ –ü—Ä–æ—Ñ–∏–ª—å</span>
    </li>
    <li class="menu-item admin-only" data-tab="admin-tab" style="display: none;">
      <i class="fas fa-cog"></i>
      <span>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
    </li>
    
    <li class="menu-divider"></li>
    
    <li class="theme-switch" id="themeSwitch">
      <div class="theme-label">
        <i class="fas fa-moon"></i>
        <span>üåì –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</span>
      </div>
      <label class="theme-toggle-switch">
        <input type="checkbox" id="themeToggleInput">
        <span class="theme-toggle-slider"></span>
      </label>
    </li>
  </ul>
  
  <div class="menu-footer">
    <small>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–µ–º–∏–∏ –ú–ü–ü v2.1</small>
  </div>
</div>

<div class="container">
<header>
<div class="header-left">
  <button class="menu-button" id="menuButton">
    <i class="fas fa-bars"></i>
  </button>
</div>
<div class="header-center">
  <h1 id="headerTitle">–ì–ª–∞–≤–Ω–∞—è</h1>
  <p id="headerSubtitle">–ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–µ–º–∏–∏</p>
</div>
<div class="header-right">
  <div class="user-info" id="userInfo">
    <div class="user-avatar" id="userAvatar">U</div>
  </div>
</div>
</header>

<!-- –ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê: –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê -->
<div class="tab-content active" id="home-tab">
  <div class="calculator-container">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
    <div class="home-welcome-card">
      <div class="home-welcome-title" id="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
      <div class="home-welcome-text" id="welcome-text">
        –≠—Ç–æ –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–∞—Å—á–µ—Ç—É –ø—Ä–µ–º–∏–∏. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Å—Ç—Ä–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–º–∏—é, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.
      </div>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ü–∏—Ç–∞—Ç–æ–π -->
    <div class="quote-card">
      <i class="fas fa-quote-left quote-icon"></i>
      <div class="quote-text" id="daily-quote">
        –£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç –Ω–µ—É–¥–∞—á–∏ –∫ –Ω–µ—É–¥–∞—á–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞.
      </div>
      <div class="quote-author" id="quote-author">–£–∏–Ω—Å—Ç–æ–Ω –ß–µ—Ä—á–∏–ª–ª—å</div>
    </div>
    
    <!-- –í–∏–¥–∂–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø—Ä–µ–º–∏–∏ -->
    <div class="premium-forecast-card">
      <div class="premium-forecast-title">–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–µ–º–∏–∏ –Ω–∞ –º–µ—Å—è—Ü</div>
      <div class="premium-forecast-amount" id="premium-forecast-amount">0 ‚ÇΩ</div>
      <div class="premium-forecast-period" id="premium-forecast-period">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
      <div class="premium-forecast-progress">
        <div class="premium-forecast-progress-bar" id="premium-forecast-progress" style="width: 0%"></div>
      </div>
      <div class="premium-forecast-comparison" id="premium-forecast-comparison">
        –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...
      </div>
    </div>
    
    <!-- –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="quick-stats-grid">
      <div class="quick-stat-card">
        <div class="quick-stat-icon">
          <i class="fas fa-credit-card"></i>
        </div>
        <div class="quick-stat-value" id="quick-credits">0</div>
        <div class="quick-stat-label">–ö—Ä–µ–¥–∏—Ç—ã –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">
          <i class="fas fa-piggy-bank"></i>
        </div>
        <div class="quick-stat-value" id="quick-deposits">0</div>
        <div class="quick-stat-label">–í–∫–ª–∞–¥—ã –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <div class="quick-stat-value" id="quick-krh">0</div>
        <div class="quick-stat-label">–°—Ç–∞—Ä—Ç –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="quick-stat-value" id="quick-strata">0</div>
        <div class="quick-stat-label">–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞—Ç–∞</div>
      </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ -->
    <button class="start-calculation-btn" id="start-calculation-btn">
      <i class="fas fa-calculator"></i> –ù–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç –ø—Ä–µ–º–∏–∏
    </button>
  </div>
</div>

<!-- –†–∞–∑–¥–µ–ª –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –ú–ü–ü -->
<div class="tab-content" id="calculator-tab">
<div class="calculator-container" id="mpp-calculator">
<!-- –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö -->
<div id="motivation-changes-notification" class="changes-notification" style="display: none;">
  <div class="changes-header">
    <i class="fas fa-exclamation-circle"></i>
    <div class="changes-title">–í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ—Ç–∏–≤–∞—Ü–∏–∏</div>
  </div>
  <div class="changes-content" id="motivation-changes-content"></div>
  <div class="changes-date" id="motivation-changes-date"></div>
</div>

<!-- –°–µ–∫—Ü–∏—è 1: –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å -->
<div class="section">
<h2 class="section-title"><i class="fas fa-user-tie"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
<div class="form-group">
<label for="moscow_coef">–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:</label>
<select id="moscow_coef">
<option value="1">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (√ó1.0)</option>
<option value="1.3" selected>–ú–æ—Å–∫–≤–∞ (√ó1.3)</option>
</select>
</div>
<div class="form-group">
<label for="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</label>
<select id="position">
<option value="0" selected>–ú–ü–ü</option>
<option value="3000">–°—Ç–∞—Ä—à–∏–π –ú–ü–ü (+3,000‚ÇΩ)</option>
<option value="5000">–í–µ–¥—É—â–∏–π –ú–ü–ü (+5,000‚ÇΩ)</option>
<option value="10000">–ì–ª–∞–≤–Ω—ã–π –ú–ü–ü (+10,000‚ÇΩ)</option>
<option value="20000">–≠–∫—Å–ø–µ—Ä—Ç –ú–ü–ü (+20,000‚ÇΩ)</option>
</select>
</div>
</div>

<!-- –°–µ–∫—Ü–∏—è 2: –ü–ª–∞–Ω/–§–∞–∫—Ç –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º -->
<div class="section">
<h2 class="section-title"><i class="fas fa-chart-line"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h2>
<div class="plan-fact-container">
<div>
<label for="krh_plan">–ö–†–• (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="krh_plan" min="0" max="1000" value="14">
</div>
<div>
<label for="krh_fact">–ö–†–• (—Ñ–∞–∫—Ç, —à—Ç.):</label>
<input type="number" id="krh_fact" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="vklad_volume_plan">–í–∫–ª–∞–¥ –æ–±—ä–µ–º (–ø–ª–∞–Ω, —Ä—É–±.):</label>
<input type="number" id="vklad_volume_plan" min="0" max="100000000" value="1920000">
</div>
<div>
<label for="vklad_volume_fact">–í–∫–ª–∞–¥ –æ–±—ä–µ–º (—Ñ–∞–∫—Ç, —Ä—É–±.):</label>
<input type="number" id="vklad_volume_fact" min="0" max="100000000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="vklad_count_plan">–í–∫–ª–∞–¥—ã (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="vklad_count_plan" min="0" max="1000" value="4">
</div>
<div>
<label for="vklad_count_fact">–í–∫–ª–∞–¥—ã (—Ñ–∞–∫—Ç, —à—Ç.):</label>
<input type="number" id="vklad_count_fact" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="dk_count_plan">–î–ö (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="dk_count_plan" min="0" max="1000" value="2">
</div>
<div>
<label for="dk_volume_plan">–î–ö –æ–±—ä–µ–º (–ø–ª–∞–Ω, —Ä—É–±.):</label>
<input type="number" id="dk_volume_plan" min="0" max="100000000" value="960000">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="dk_volume_fact">–î–ö –æ–±—ä–µ–º (—Ñ–∞–∫—Ç, —Ä—É–±.):</label>
<input type="number" id="dk_volume_fact" min="0" max="100000000" value="0" readonly style="background-color: #f0f8ff;">
</div>
<div>
<label for="kvc_plan">–ö–í–¶ (–ø–ª–∞–Ω, –∫–ª–∏–µ–Ω—Ç—ã):</label>
<input type="number" id="kvc_plan" min="0" max="1000" value="30">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="kvc_fact">–ö–í–¶ (—Ñ–∞–∫—Ç, –∫–ª–∏–µ–Ω—Ç—ã):</label>
<input type="number" id="kvc_fact" min="0" max="1000" value="0">
</div>
</div>
</div>

<!-- –°–µ–∫—Ü–∏—è 3: –ö—Ä–µ–¥–∏—Ç—ã -->
<div class="section">
<h2 class="section-title"><i class="fas fa-credit-card"></i> –ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h2>
<p style="margin-bottom: 15px; color: #666;">–î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞, –ø–∞–∫–µ—Ç–∞ –∑–∞—â–∏—Ç—ã –∏ –§–ó</p>
<div id="credits-container">
<!-- –ö—Ä–µ–¥–∏—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<button class="btn" id="add-credit-btn">
<i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç
</button>
</div>

<!-- –°–µ–∫—Ü–∏—è 4: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã -->
<div class="section">
<h2 class="section-title"><i class="fas fa-cube"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h2>
<div class="plan-fact-container">
<div>
<label for="omp_count">–û–ú–ü (—à—Ç.):</label>
<input type="number" id="omp_count" min="0" max="1000" value="0">
</div>
<div>
<label for="zp_nerez_count">–ó–ü –Ω–µ—Ä–µ–∑ (—à—Ç.):</label>
<input type="number" id="zp_nerez_count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="sticker_count">–°—Ç–∏–∫–µ—Ä—ã:</label>
<input type="number" id="sticker_count" min="0" max="1000" value="0">
</div>
<div>
<label for="year_sub_count">–ü–æ–¥–ø–∏—Å–∫–∏ –≥–æ–¥–æ–≤—ã–µ:</label>
<input type="number" id="year_sub_count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="month_sub_count">–ü–æ–¥–ø–∏—Å–∫–∏ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ:</label>
<input type="number" id="month_sub_count" min="0" max="1000" value="0">
</div>
<div>
<label for="krh_limit_count">–ö–†–• –õ–∏–º–∏—Ç:</label>
<input type="number" id="krh_limit_count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label for="zp_card_count">–ó–ü –∫–∞—Ä—Ç—ã:</label>
<input type="number" id="zp_card_count" min="0" max="1000" value="0">
</div>
<div>
<label for="card_turnover">–û–±–æ—Ä–æ—Ç –ø–æ –∫–∞—Ä—Ç–∞–º (—Ä—É–±.):</label>
<input type="number" id="card_turnover" min="0" max="100000000" value="0">
</div>
</div>
</div>

<!-- –°–µ–∫—Ü–∏—è 5: –ß–µ–º–ø–∏–æ–Ω–∞—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ -->
<div class="section">
<h2 class="section-title"><i class="fas fa-trophy"></i> –ß–µ–º–ø–∏–æ–Ω–∞—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤</h2>
<div class="plan-fact-container">
<div>
<label for="skb_count">–°–ö–ë (–¥–µ–±–µ—Ç–æ–≤—ã–µ —Å 2%):</label>
<input type="number" id="skb_count" min="0" max="1000" value="0">
</div>
<div>
<label for="crm_calls">–î–æ–∑–≤–æ–Ω—ã CRM:</label>
<input type="number" id="crm_calls" min="0" max="1000" value="0">
</div>
</div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ -->
<div style="text-align: center; margin: 25px 0;">
<button class="btn" id="calculate-btn">
<i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–º–∏—é
</button>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
<div id="results" style="display: none;">
<div class="result-card">
<div class="result-title">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏ —Å—Ç—Ä–∞—Ç—ã:</div>
<div id="plan_results"></div>
</div>
<div class="result-card">
<div class="result-title">–†–∞—Å—á–µ—Ç –≤—ã–ø–ª–∞—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º:</div>
<div id="payments_results"></div>
</div>
<div class="result-card">
<div class="result-title">–ß–µ–º–ø–∏–æ–Ω–∞—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤:</div>
<div id="championship_results"></div>
</div>

<div class="result-card">
<div class="result-title">–†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç—ã:</div>
<div id="final_strata_calculation"></div>
</div>

<!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ -->
<div class="result-card">
<div class="result-title">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞:</div>
<div class="detailed-calculation" id="detailed_calculation"></div>
</div>

<!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–µ–º–∏–∏ -->
<div class="result-card">
<div class="result-title">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–µ–º–∏–∏:</div>
<div class="premium-structure" id="premium_structure">
<div class="chart-container">
<canvas id="premium-chart" class="premium-chart"></canvas>
<div class="chart-center">
<div class="chart-total" id="chart-total">0 ‚ÇΩ</div>
<div class="chart-percent">100%</div>
</div>
</div>
<div class="chart-legend" id="chart-legend">
<!-- –õ–µ–≥–µ–Ω–¥–∞ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
</div>
</div>
<div class="final-result">
<div>–í–∞—à–∞ –ø—Ä–µ–º–∏—è —Å–æ—Å—Ç–∞–≤–∏—Ç:</div>
<div class="final-amount" id="final_premium">0 ‚ÇΩ</div>
<div>–¥–æ –≤—ã—á–µ—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤</div>
</div>
</div>
</div>
</div>

<!-- –†–∞–∑–¥–µ–ª –æ—Ç—á–µ—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ú–ü–ü) -->
<div class="tab-content" id="reports-tab">
<!-- –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–æ–≤ -->
<div class="calculator-container">
<div class="section reports-section">
<h2 class="section-title"><i class="fas fa-chart-bar"></i> –û—Ç—á–µ—Ç—ã</h2>
<div class="report-type-selector">
<button class="report-type-btn active" data-type="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç</button>
<button class="report-type-btn" data-type="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç</button>
</div>

<!-- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã -->
<div class="report-form weekly-report active">
<div id="monthly-report-alert" class="alert" style="display: none;">
<i class="fas fa-exclamation-triangle"></i>
<span id="alert-message"></span>
</div>
<div class="reports-form">
<h3>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
<div class="form-group">
<label>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ–¥–µ–ª—é:</label>
<div class="week-options" id="week-options">
<!-- –ù–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
</div>
<h4>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h4>
<div class="plan-fact-container">
<div>
<label>–ö–í–¶ –∫–ª–∏–µ–Ω—Ç—ã:</label>
<input type="number" id="report-kvc" min="0" max="1000" value="0">
</div>
<div>
<label>–ö–†–• —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–æ:</label>
<input type="number" id="report-krh" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–î–ö –æ–±—ä–µ–º (—Ä—É–±.):</label>
<input type="number" id="report-dk-volume" min="0" max="100000000" value="0">
</div>
<div>
<label>–í–∫–ª–∞–¥ –æ–±—ä–µ–º (—Ä—É–±.):</label>
<input type="number" id="report-vklad-volume" min="0" max="100000000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–î–ö –∫–æ–ª-–≤–æ (—à—Ç.):</label>
<input type="number" id="report-dk-count" min="0" max="1000" value="0">
</div>
<div>
<label>–í–∫–ª–∞–¥ –∫–æ–ª-–≤–æ (—à—Ç.):</label>
<input type="number" id="report-vklad-count" min="0" max="1000" value="0">
</div>
</div>
<!-- –ö—Ä–µ–¥–∏—Ç—ã –≤ –æ—Ç—á–µ—Ç–∞—Ö -->
<h4>–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h4>
<div id="report-credits-container">
<!-- –ö—Ä–µ–¥–∏—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<button class="btn" id="report-add-credit-btn">
<i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç –≤ –æ—Ç—á–µ—Ç
</button>
<h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h4>
<div class="plan-fact-container">
<div>
<label>–°—Ç–∏–∫–µ—Ä—ã:</label>
<input type="number" id="report-sticker-count" min="0" max="1000" value="0">
</div>
<div>
<label>–ü–æ–¥–ø–∏—Å–∫–∏ –≥–æ–¥–æ–≤—ã–µ:</label>
<input type="number" id="report-year-sub-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ü–æ–¥–ø–∏—Å–∫–∏ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ:</label>
<input type="number" id="report-month-sub-count" min="0" max="1000" value="0">
</div>
<div>
<label>–ö–†–• –õ–∏–º–∏—Ç:</label>
<input type="number" id="report-krh-limit-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ó–ü –∫–∞—Ä—Ç—ã:</label>
<input type="number" id="report-zp-card-count" min="0" max="1000" value="0">
</div>
<div>
<label>–û–ú–ü (—à—Ç.):</label>
<input type="number" id="report-omp-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ó–ü –Ω–µ—Ä–µ–∑ (—à—Ç.):</label>
<input type="number" id="report-zp-nerez-count" min="0" max="1000" value="0">
</div>
<div>
<label>–û–±–æ—Ä–æ—Ç –ø–æ –∫–∞—Ä—Ç–∞–º (—Ä—É–±.):</label>
<input type="number" id="report-card-turnover" min="0" max="100000000" value="0">
</div>
</div>
<h4>–ß–µ–º–ø–∏–æ–Ω–∞—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤</h4>
<div class="plan-fact-container">
<div>
<label>–°–ö–ë (–¥–µ–±–µ—Ç–æ–≤—ã–µ —Å 2%):</label>
<input type="number" id="report-skb-count" min="0" max="1000" value="0">
</div>
<div>
<label>–î–æ–∑–≤–æ–Ω—ã CRM:</label>
<input type="number" id="report-crm-calls" min="0" max="1000" value="0">
</div>
</div>
<button class="btn" id="save-weekly-report-btn">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç
</button>
</div>
</div>

<!-- –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã -->
<div class="report-form monthly-report">
<div class="reports-form">
<h3>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü</h3>
<div class="form-group">
<label>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü:</label>
<div class="month-selector">
<select id="month-select" class="month-select">
<!-- –ú–µ—Å—è—Ü—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</select>
</div>
</div>
<h4>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h4>
<div class="plan-fact-container">
<div>
<label>–ö–í–¶ –∫–ª–∏–µ–Ω—Ç—ã:</label>
<input type="number" id="monthly-report-kvc" min="0" max="1000" value="0">
</div>
<div>
<label>–ö–†–• —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–æ:</label>
<input type="number" id="monthly-report-krh" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–î–ö –æ–±—ä–µ–º (—Ä—É–±.):</label>
<input type="number" id="monthly-report-dk-volume" min="0" max="100000000" value="0">
</div>
<div>
<label>–í–∫–ª–∞–¥ –æ–±—ä–µ–º (—Ä—É–±.):</label>
<input type="number" id="monthly-report-vklad-volume" min="0" max="100000000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–î–ö –∫–æ–ª-–≤–æ (—à—Ç.):</label>
<input type="number" id="monthly-report-dk-count" min="0" max="1000" value="0">
</div>
<div>
<label>–í–∫–ª–∞–¥ –∫–æ–ª-–≤–æ (—à—Ç.):</label>
<input type="number" id="monthly-report-vklad-count" min="0" max="1000" value="0">
</div>
</div>
<!-- –ö—Ä–µ–¥–∏—Ç—ã –≤ –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö -->
<h4>–ö—Ä–µ–¥–∏—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h4>
<div id="monthly-report-credits-container">
<!-- –ö—Ä–µ–¥–∏—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
<button class="btn" id="monthly-report-add-credit-btn">
<i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç –≤ –æ—Ç—á–µ—Ç
</button>
<h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h4>
<div class="plan-fact-container">
<div>
<label>–°—Ç–∏–∫–µ—Ä—ã:</label>
<input type="number" id="monthly-report-sticker-count" min="0" max="1000" value="0">
</div>
<div>
<label>–ü–æ–¥–ø–∏—Å–∫–∏ –≥–æ–¥–æ–≤—ã–µ:</label>
<input type="number" id="monthly-report-year-sub-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ü–æ–¥–ø–∏—Å–∫–∏ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ:</label>
<input type="number" id="monthly-report-month-sub-count" min="0" max="1000" value="0">
</div>
<div>
<label>–ö–†–• –õ–∏–º–∏—Ç:</label>
<input type="number" id="monthly-report-krh-limit-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ó–ü –∫–∞—Ä—Ç—ã:</label>
<input type="number" id="monthly-report-zp-card-count" min="0" max="1000" value="0">
</div>
<div>
<label>–û–ú–ü (—à—Ç.):</label>
<input type="number" id="monthly-report-omp-count" min="0" max="1000" value="0">
</div>
</div>
<div class="plan-fact-container">
<div>
<label>–ó–ü –Ω–µ—Ä–µ–∑ (—à—Ç.):</label>
<input type="number" id="monthly-report-zp-nerez-count" min="0" max="1000" value="0">
</div>
<div>
<label>–û–±–æ—Ä–æ—Ç –ø–æ –∫–∞—Ä—Ç–∞–º (—Ä—É–±.):</label>
<input type="number" id="monthly-report-card-turnover" min="0" max="100000000" value="0">
</div>
</div>
<h4>–ß–µ–º–ø–∏–æ–Ω–∞—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤</h4>
<div class="plan-fact-container">
<div>
<label>–°–ö–ë (–¥–µ–±–µ—Ç–æ–≤—ã–µ —Å 2%):</label>
<input type="number" id="monthly-report-skb-count" min="0" max="1000" value="0">
</div>
<div>
<label>–î–æ–∑–≤–æ–Ω—ã CRM:</label>
<input type="number" id="monthly-report-crm-calls" min="0" max="1000" value="0">
</div>
</div>

<!-- –ü–æ–ª–µ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–µ–º–∏–∏ -->
<div class="form-group">
<label for="monthly-adjusted-premium">–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–µ–º–∏—è (–º–æ–∂–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å):</label>
<input type="number" id="monthly-adjusted-premium" min="0" max="1000000" value="0">
</div>

<button class="btn" id="save-monthly-report-btn">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç
</button>
</div>
</div>
</div>
</div>
</div>

<!-- –†–∞–∑–¥–µ–ª —Ç–æ–ø–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ú–ü–ü) -->
<div class="tab-content" id="leaderboard-tab">
<!-- –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–ø–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
<div class="calculator-container">
<div class="section leaderboard-section">
<h2 class="section-title"><i class="fas fa-crown"></i> –¢–æ–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
<div class="leaderboard-period-selector">
<button class="period-btn active" data-period="week">–¢–æ–ø –Ω–µ–¥–µ–ª–∏</button>
<button class="period-btn" data-period="month">–¢–æ–ø –º–µ—Å—è—Ü–∞</button>
<button class="period-btn" data-period="last-month">–õ—É—á—à–∏–µ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</button>
<button class="period-btn" data-period="records">–†–µ–∫–æ—Ä–¥—ã –ø—Ä–æ–¥–∞–∂</button>
</div>

<div id="current-period-leaderboard">
<h3>üèÜ –¢–æ–ø –ø–æ –ø—Ä–µ–º–∏–∏</h3>
<div id="premium-leaderboard">
<!-- –¢–æ–ø –ø–æ –ø—Ä–µ–º–∏–∏ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
<h3>üìä –¢–æ–ø –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º</h3>
<div id="credits-leaderboard">
<!-- –¢–æ–ø –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
<h3>üí∞ –¢–æ–ø –ø–æ –≤–∫–ª–∞–¥–∞–º</h3>
<div id="deposits-leaderboard">
<!-- –¢–æ–ø –ø–æ –≤–∫–ª–∞–¥–∞–º –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
</div>

<div class="last-month-leaderboard" id="last-month-leaderboard" style="display: none;">
<h3>üèÜ –õ—É—á—à–∏–µ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</h3>
<div id="last-month-premium-leaderboard">
<!-- –¢–æ–ø –ø–æ –ø—Ä–µ–º–∏–∏ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
</div>

<!-- –ù–û–í–ê–Ø –°–ï–ö–¶–ò–Ø: –†–ï–ö–û–†–î–´ –ü–†–û–î–ê–ñ -->
<div class="records-container" id="records-leaderboard" style="display: none;">
<h3>üèÖ –†–µ–∫–æ—Ä–¥—ã –ø—Ä–æ–¥–∞–∂</h3>

<!-- –§–æ—Ä–º–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
<div class="record-form" id="record-form" style="display: none;">
<div class="record-form-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</div>
<div class="record-input-group">
<div class="record-input">
<label for="record-type">–¢–∏–ø —Ä–µ–∫–æ—Ä–¥–∞:</label>
<select id="record-type">
<option value="credits">–ö—Ä–µ–¥–∏—Ç—ã (–∫–æ–ª-–≤–æ)</option>
<option value="deposits">–í–∫–ª–∞–¥—ã (–∫–æ–ª-–≤–æ)</option>
<option value="krh">–°—Ç–∞—Ä—Ç (–∫–æ–ª-–≤–æ)</option>
</select>
</div>
<div class="record-input">
<label for="record-value">–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
<input type="number" id="record-value" min="0" max="1000" value="0">
</div>
</div>

<!-- –ù–û–í–´–ô –ö–û–ú–ü–û–ù–ï–ù–¢ –î–õ–Ø –ü–û–ò–°–ö–ê –°–û–¢–†–£–î–ù–ò–ö–û–í -->
<div class="record-input">
<label for="user-search">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
<div class="custom-select-wrapper">
<div class="search-input-container">
<input type="text" class="search-input" id="user-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
<i class="fas fa-search search-icon"></i>
</div>
<div class="search-results" id="user-search-results">
<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
</div>
</div>
<div class="selected-user" id="selected-user" style="display: none;">
–í—ã–±—Ä–∞–Ω: <span id="selected-user-name"></span>
<input type="hidden" id="selected-user-id">
</div>
</div>

<button class="record-btn" id="save-record-btn">
<i class="fas fa-trophy"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥
</button>
</div>

<!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
<div class="record-item">
<div class="record-header">
<div class="record-title">–ö—Ä–µ–¥–∏—Ç—ã (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="credits-record-value">0</div>
</div>
<div class="record-user" id="credits-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
</div>

<div class="record-item">
<div class="record-header">
<div class="record-title">–í–∫–ª–∞–¥—ã (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="deposits-record-value">0</div>
</div>
<div class="record-user" id="deposits-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
</div>

<div class="record-item">
<div class="record-header">
<div class="record-title">–°—Ç–∞—Ä—Ç (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="krh-record-value">0</div>
</div>
<div class="record-user" id="krh-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
</div>
</div>
</div>
</div>
</div>

<!-- –†–∞–∑–¥–µ–ª –ø—Ä–æ—Ñ–∏–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –ú–ü–ü) -->
<div class="tab-content" id="profile-tab">
<div class="calculator-container">
<div class="section profile-section">
<h2 class="section-title"><i class="fas fa-user"></i> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
  
<!-- –í–∫–ª–∞–¥–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="profile-tabs">
<button class="profile-tab active" data-tab="profile-stats-tab">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
<button class="profile-tab" data-tab="profile-growth-tab">–ó–æ–Ω–∞ —Ä–æ—Å—Ç–∞</button>
<button class="profile-tab" data-tab="profile-history-tab">–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–º–∏–π</button>
<button class="profile-tab" data-tab="profile-badges-tab">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div class="profile-content active" id="profile-stats-tab">
<div class="profile-stats">
<div class="profile-stat">
<div class="profile-stat-value" id="total-premium">0 ‚ÇΩ</div>
<div class="profile-stat-label">–û–±—â–∞—è –ø—Ä–µ–º–∏—è</div>
</div>
<div class="profile-stat">
<div class="profile-stat-value" id="average-premium">0 ‚ÇΩ</div>
<div class="profile-stat-label">–°—Ä–µ–¥–Ω—è—è –ø—Ä–µ–º–∏—è</div>
</div>
<div class="profile-stat">
<div class="profile-stat-value" id="total-credits">0</div>
<div class="profile-stat-label">–í—Å–µ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤</div>
</div>
<div class="profile-stat">
<div class="profile-stat-value" id="total-deposits">0</div>
<div class="profile-stat-label">–í—Å–µ–≥–æ –≤–∫–ª–∞–¥–æ–≤</div>
</div>
</div>

<div class="premium-history">
<h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–º–∏–∏</h3>
<div id="premium-history-list">
<!-- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–º–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
</div>
</div>

<!-- –ù–û–í–ê–Ø –í–ö–õ–ê–î–ö–ê: –ó–û–ù–ê –†–û–°–¢–ê -->
<div class="profile-content" id="profile-growth-tab">
<div class="growth-zone-section">
<h3 class="section-title"><i class="fas fa-seedling"></i> –ó–æ–Ω–∞ —Ä–æ—Å—Ç–∞</h3>
<p style="margin-bottom: 20px; color: var(--text-color); opacity: 0.8;">
–ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏. –í—ã—è–≤–∏—Ç–µ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é.
</p>

<!-- –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="growth-stats-grid">
<div class="growth-stat-card">
<div class="growth-stat-title">–ü—Ä–µ–º–∏—è vs –°—Ä–µ–¥–Ω—è—è</div>
<div class="growth-stat-value positive" id="growth-premium-comparison">+0%</div>
<div class="growth-stat-comparison">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ä–µ–¥–Ω–∏–º –ø–æ –æ—Ç–¥–µ–ª—É</div>
</div>

<div class="growth-stat-card">
<div class="growth-stat-title">–ö—Ä–µ–¥–∏—Ç—ã vs –°—Ä–µ–¥–Ω–∏–µ</div>
<div class="growth-stat-value" id="growth-credits-comparison">0%</div>
<div class="growth-stat-comparison">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ä–µ–¥–Ω–∏–º –ø–æ –æ—Ç–¥–µ–ª—É</div>
</div>

<div class="growth-stat-card">
<div class="growth-stat-title">–í–∫–ª–∞–¥—ã vs –°—Ä–µ–¥–Ω–∏–µ</div>
<div class="growth-stat-value" id="growth-deposits-comparison">0%</div>
<div class="growth-stat-comparison">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ä–µ–¥–Ω–∏–º –ø–æ –æ—Ç–¥–µ–ª—É</div>
</div>

<div class="growth-stat-card">
<div class="growth-stat-title">–ö–†–• vs –°—Ä–µ–¥–Ω–∏–µ</div>
<div class="growth-stat-value" id="growth-krh-comparison">0%</div>
<div class="growth-stat-comparison">–ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å–æ —Å—Ä–µ–¥–Ω–∏–º –ø–æ –æ—Ç–¥–µ–ª—É</div>
</div>
</div>

<!-- –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ -->
<div class="weak-spots-container">
<div class="weak-spots-title">
<i class="fas fa-exclamation-triangle"></i>
–°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞
</div>
<div id="weak-spots-list">
<div class="weak-spot-item">
<div class="weak-spot-info">
<div class="weak-spot-name">–ö–í–¶ –∫–ª–∏–µ–Ω—Ç—ã</div>
<div class="weak-spot-description">–ù–∞ 30% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è</div>
</div>
<div class="weak-spot-value">
15<span class="weak-spot-percent">(-30%)</span>
</div>
</div>
<div class="weak-spot-item">
<div class="weak-spot-info">
<div class="weak-spot-name">–î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã</div>
<div class="weak-spot-description">–ù–∞ 25% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è</div>
</div>
<div class="weak-spot-value">
8<span class="weak-spot-percent">(-25%)</span>
</div>
</div>
</div>
</div>

<!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é -->
<div class="recommendations-container">
<div class="recommendations-title">
<i class="fas fa-lightbulb"></i>
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
</div>
<div id="recommendations-list">
<div class="recommendation-item">
<div class="recommendation-icon"><i class="fas fa-check-circle"></i></div>
<div class="recommendation-text">–£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ö–í–¶ –∫–ª–∏–µ–Ω—Ç–æ–≤. –¶–µ–ª–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: 25+ –≤ –Ω–µ–¥–µ–ª—é</div>
</div>
<div class="recommendation-item">
<div class="recommendation-icon"><i class="fas fa-check-circle"></i></div>
<div class="recommendation-text">–ê–∫—Ç–∏–≤–Ω–µ–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (—Å—Ç–∏–∫–µ—Ä—ã, –ø–æ–¥–ø–∏—Å–∫–∏)</div>
</div>
<div class="recommendation-item">
<div class="recommendation-icon"><i class="fas fa-check-circle"></i></div>
<div class="recommendation-text">–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ 3+ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –º–µ—Å—è—Ü –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫—Å—Ç—Ä–∞–±–æ–Ω—É—Å–∞</div>
</div>
<div class="recommendation-item">
<div class="recommendation-icon"><i class="fas fa-check-circle"></i></div>
<div class="recommendation-text">–£–ª—É—á—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–∑–≤–æ–Ω–æ–≤ CRM –¥–æ 50+ –≤ –Ω–µ–¥–µ–ª—é</div>
</div>
</div>
</div>
</div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–º–∏–π -->
<div class="profile-content" id="profile-history-tab">
<div class="premium-history">
<h3>–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–º–∏–π</h3>
<div id="full-premium-history-list">
<!-- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–º–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
</div>
</div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π -->
<div class="profile-content" id="profile-badges-tab">
<h3>–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
<div class="badge-grid" id="badge-grid">
<!-- –ë–µ–π–¥–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>
</div>
</div>
</div>
</div>

<!-- –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ -->
<div class="tab-content" id="admin-tab">
<div class="calculator-container">
<div class="section">
<h2 class="section-title"><i class="fas fa-crown"></i> –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>

<div class="admin-tabs">
<button class="admin-tab active" data-tab="admin-plans">–ü–ª–∞–Ω—ã</button>
<button class="admin-tab" data-tab="admin-changes">–ò–∑–º–µ–Ω–µ–Ω–∏—è</button>
<button class="admin-tab" data-tab="admin-records">–†–µ–∫–æ—Ä–¥—ã</button>
</div>

<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞–º–∏ -->
<div class="admin-content active" id="admin-plans">
<div class="section">
<h3 class="section-title"><i class="fas fa-target"></i> –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–Ω–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</h3>
<p style="margin-bottom: 15px;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–Ω–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –ú–ü–ü –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Å—è—Ü</p>

<div class="form-group">
<label for="admin-plan-month">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü:</label>
<select id="admin-plan-month" class="month-select">
<!-- –ú–µ—Å—è—Ü—ã –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</select>
</div>

<div class="admin-plans-form">
<div class="plan-input-group">
<div class="plan-input">
<label for="admin-krh-plan">–ö–†–• (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="admin-krh-plan" min="0" max="1000" value="14">
</div>
<div class="plan-input">
<label for="admin-vklad-volume-plan">–í–∫–ª–∞–¥ –æ–±—ä–µ–º (–ø–ª–∞–Ω, —Ä—É–±.):</label>
<input type="number" id="admin-vklad-volume-plan" min="0" max="100000000" value="1920000">
</div>
</div>
<div class="plan-input-group">
<div class="plan-input">
<label for="admin-vklad-count-plan">–í–∫–ª–∞–¥—ã (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="admin-vklad-count-plan" min="0" max="1000" value="4">
</div>
<div class="plan-input">
<label for="admin-dk-count-plan">–î–ö (–ø–ª–∞–Ω, —à—Ç.):</label>
<input type="number" id="admin-dk-count-plan" min="0" max="1000" value="2">
</div>
</div>
<div class="plan-input-group">
<div class="plan-input">
<label for="admin-dk-volume-plan">–î–ö –æ–±—ä–µ–º (–ø–ª–∞–Ω, —Ä—É–±.):</label>
<input type="number" id="admin-dk-volume-plan" min="0" max="100000000" value="960000">
</div>
<div class="plan-input">
<label for="admin-kvc-plan">–ö–í–¶ (–ø–ª–∞–Ω, –∫–ª–∏–µ–Ω—Ç—ã):</label>
<input type="number" id="admin-kvc-plan" min="0" max="1000" value="30">
</div>
</div>
</div>

<button class="btn" id="save-plans-btn">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω—ã
</button>
</div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
<div class="admin-content" id="admin-changes">
<div class="section changes-form">
<h3 class="section-title"><i class="fas fa-exclamation-circle"></i> –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ—Ç–∏–≤–∞—Ü–∏–∏</h3>
<p style="margin-bottom: 15px;">–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ—Ç–∏–≤–∞—Ü–∏—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞. –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–≤–∏–¥—è—Ç –≤—Å–µ –ú–ü–ü –≤–æ –≤–∫–ª–∞–¥–∫–µ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä".</p>
<div class="form-group">
<label for="changes-text">–¢–µ–∫—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:</label>
<textarea id="changes-text" rows="10" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-color); color: var(--text-color);"></textarea>
</div>
<button class="btn" id="save-changes-btn">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
</button>
</div>
</div>

<!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞–º–∏ -->
<div class="admin-content" id="admin-records">
<div class="section">
<h3 class="section-title"><i class="fas fa-trophy"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞–º–∏ –ø—Ä–æ–¥–∞–∂</h3>
<p style="margin-bottom: 15px;">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∫–æ—Ä–¥—ã –ø—Ä–æ–¥–∞–∂ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>

<div class="record-form">
<div class="record-form-title">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥</div>
<div class="record-input-group">
<div class="record-input">
<label for="admin-record-type">–¢–∏–ø —Ä–µ–∫–æ—Ä–¥–∞:</label>
<select id="admin-record-type">
<option value="credits">–ö—Ä–µ–¥–∏—Ç—ã (–∫–æ–ª-–≤–æ)</option>
<option value="deposits">–í–∫–ª–∞–¥—ã (–∫–æ–ª-–≤–æ)</option>
<option value="krh">–°—Ç–∞—Ä—Ç (–∫–æ–ª-–≤–æ)</option>
</select>
</div>
<div class="record-input">
<label for="admin-record-value">–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
<input type="number" id="admin-record-value" min="0" max="1000" value="0">
</div>
</div>

<!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
<div class="record-input">
<label for="admin-user-search">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</label>
<div class="custom-select-wrapper">
<div class="search-input-container">
<input type="text" class="search-input" id="admin-user-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
<i class="fas fa-search search-icon"></i>
</div>
<div class="search-results" id="admin-user-search-results">
<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
</div>
</div>
<div class="selected-user" id="admin-selected-user" style="display: none;">
–í—ã–±—Ä–∞–Ω: <span id="admin-selected-user-name"></span>
<input type="hidden" id="admin-selected-user-id">
</div>
</div>

<button class="record-btn" id="admin-save-record-btn">
<i class="fas fa-trophy"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥
</button>
</div>

<!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
<div class="records-container" style="margin-top: 30px;">
<h3>–¢–µ–∫—É—â–∏–µ —Ä–µ–∫–æ—Ä–¥—ã</h3>
<div class="record-item">
<div class="record-header">
<div class="record-title">–ö—Ä–µ–¥–∏—Ç—ã (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="admin-credits-record-value">0</div>
</div>
<div class="record-user" id="admin-credits-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
<button class="btn btn-remove" onclick="editRecord('credits')" style="margin-top: 10px;">
<i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
</button>
</div>

<div class="record-item">
<div class="record-header">
<div class="record-title">–í–∫–ª–∞–¥—ã (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="admin-deposits-record-value">0</div>
</div>
<div class="record-user" id="admin-deposits-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
<button class="btn btn-remove" onclick="editRecord('deposits')" style="margin-top: 10px;">
<i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
</button>
</div>

<div class="record-item">
<div class="record-header">
<div class="record-title">–°—Ç–∞—Ä—Ç (–∫–æ–ª-–≤–æ)</div>
<div class="record-value" id="admin-krh-record-value">0</div>
</div>
<div class="record-user" id="admin-krh-record-user">–†–µ–∫–æ—Ä–¥ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
<button class="btn btn-remove" onclick="editRecord('krh')" style="margin-top: 10px;">
<i class="fas fa-edit"></i> –ò–∑–º–µ–Ω–∏—Ç—å
</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<script>
// üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCdQ8_gViAkfeHvabiHI5n9C9EP7hQW_j4",
  authDomain: "mpp-premium-calculator.firebaseapp.com",
  projectId: "mpp-premium-calculator",
  storageBucket: "mpp-premium-calculator.firebasestorage.app",
  messagingSenderId: "310897873427",
  appId: "1:310897873427:web:f2b65971191ca4359aa5e6"
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
let db = null;
let firebaseInitialized = false;

async function initializeFirebase() {
  try {
    showLoader("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...");
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    await db.collection('users').limit(1).get();
    firebaseInitialized = true;
    console.log("Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ");
    hideLoader();
    return true;
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
    firebaseInitialized = false;
    hideLoader();
    showError("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ.");
    return false;
  }
}

// –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê –°–¢–†–ê–¢ –î–õ–Ø –û–°–ù–û–í–ù–´–• –ü–û–ö–ê–ó–ê–¢–ï–õ–ï–ô
const STRATA_RULES = [
  { min: 120, strata: 1, multiplier: 1.15, points: 1 },
  { min: 110, strata: 2, multiplier: 1.10, points: 2 },
  { min: 100, strata: 3, multiplier: 1.00, points: 3 },
  { min: 90, strata: 4, multiplier: 0.90, points: 4 },
  { min: 80, strata: 5, multiplier: 0.80, points: 5 },
  { min: 70, strata: 6, multiplier: 0.70, points: 6 },
  { min: 60, strata: 7, multiplier: 0.00, points: 7 },
  { min: 50, strata: 8, multiplier: 0.00, points: 8 },
  { min: 40, strata: 9, multiplier: 0.00, points: 9 },
  { min: 30, strata: 10, multiplier: 0.00, points: 10 },
  { min: 0, strata: 20, multiplier: 0.00, points: 20 }
];

// –°–ò–°–¢–ï–ú–ê –ò–¢–û–ì–û–í–´–• –°–¢–†–ê–¢
const FINAL_STRATA_RULES = [
  { min: 49, strata: 20 },
  { min: 39, strata: 10 },
  { min: 35, strata: 9 },
  { min: 31, strata: 8 },
  { min: 27, strata: 7 },
  { min: 23, strata: 6 },
  { min: 19, strata: 5 },
  { min: 15, strata: 4 },
  { min: 11, strata: 3 },
  { min: 6, strata: 2 },
  { min: 1, strata: 1 }
];

// –¢–∏–ø—ã –∫—Ä–µ–¥–∏—Ç–æ–≤ –∏ –∏—Ö —Å—Ç–æ–∏–º–æ—Å—Ç–∏
const CREDIT_TYPES = {
  'zp': { name: '–ó–∞—Ä–ø–ª–∞—Ç–Ω—ã–π', base: 0, packageMultiplier: 1, fzRequired: true },
  'prime': { name: '–ü—Ä–∞–π–º', base: 0, packageMultiplier: 0.5, fzRequired: true },
  'autocredit': { name: '–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç/–î–ö–ü–ó–ê', base: 1250, packageMultiplier: 1, fzRequired: true },
  'ipoteka': { name: '–ò–ø–æ—Ç–µ–∫–∞', base: 7000, packageMultiplier: 0, fzRequired: false },
  'dkpzn': { name: '–î–ö–ü–ó–ù', base: 2000, packageMultiplier: 1, fzRequired: true },
  'mkk_no_fz': { name: '–ú–ö–ö –±–µ–∑ –§–ó', base: 1000, packageMultiplier: 0, fzRequired: false },
  'mkk_with_fz': { name: '–ú–ö–ö —Å –§–ó', base: 1500, packageMultiplier: 0, fzRequired: true },
  'halva_refinance': { name: '–†–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –•–∞–ª–≤–æ–π', base: 0, packageMultiplier: 0, fzRequired: false }
};

// –ü–∞–∫–µ—Ç—ã –∑–∞—â–∏—Ç—ã
const PACKAGES = [
  { value: 0, name: '–ë–µ–∑ –ø–∞–∫–µ—Ç–∞' },
  { value: 500, name: '–ü–∞–∫–µ—Ç 1 (500‚ÇΩ)' },
  { value: 1400, name: '–ü–∞–∫–µ—Ç 2 (1,400‚ÇΩ)' },
  { value: 1500, name: '–ü–∞–∫–µ—Ç 3 (1,500‚ÇΩ)' },
  { value: 2000, name: '–ü–∞–∫–µ—Ç 4 (2,000‚ÇΩ)' },
  { value: 3400, name: '–ü–∞–∫–µ—Ç 5 (3,400‚ÇΩ)' },
  { value: 4000, name: '–ü–∞–∫–µ—Ç 6 (4,000‚ÇΩ)' },
  { value: 5000, name: '–ü–∞–∫–µ—Ç 7 (5,000‚ÇΩ)' },
  { value: 6000, name: '–ü–∞–∫–µ—Ç 8 (6,000‚ÇΩ)' },
  { value: 7000, name: '–ü–∞–∫–µ—Ç 9 (7,000‚ÇΩ)' },
  { value: 8000, name: '–ü–∞–∫–µ—Ç 10 (8,000‚ÇΩ)' }
];

// –ú–µ—Å—è—Ü—ã –≤ —Ä–æ–¥–∏—Ç–µ–ª—å–Ω–æ–º –ø–∞–¥–µ–∂–µ
const MONTHS_GENITIVE = [
  '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
  '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
];

// –¶–≤–µ—Ç–∞ –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
const CHART_COLORS = [
  '#3498db', // —Å–∏–Ω–∏–π - –∫—Ä–µ–¥–∏—Ç—ã
  '#2ecc71', // –∑–µ–ª–µ–Ω—ã–π - –≤–∫–ª–∞–¥—ã
  '#e74c3c', // –∫—Ä–∞—Å–Ω—ã–π - –ö–†–•
  '#f39c12', // –æ—Ä–∞–Ω–∂–µ–≤—ã–π - –¥–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã
  '#9b59b6', // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π - —ç–∫—Å—Ç—Ä–∞–±–æ–Ω—É—Å
  '#1abc9c', // –±–∏—Ä—é–∑–æ–≤—ã–π - –Ω–∞–¥–±–∞–≤–∫–∞ –∑–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å
  '#34495e', // —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π - –ø—Ä–æ—á–∏–µ
  '#d35400', // —Ç–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
  '#c0392b', // —Ç–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π
  '#7f8c8d' // —Å–µ—Ä—ã–π
];

// üîß –ù–û–í–´–ï –ö–û–ù–°–¢–ê–ù–¢–´ –î–õ–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´
const MOTIVATIONAL_QUOTES = [
  {
    text: "–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –æ—Ç –Ω–µ—É–¥–∞—á–∏ –∫ –Ω–µ—É–¥–∞—á–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞.",
    author: "–£–∏–Ω—Å—Ç–æ–Ω –ß–µ—Ä—á–∏–ª–ª—å"
  },
  {
    text: "–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ ‚Äî –ª—é–±–∏—Ç—å —Ç–æ, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å.",
    author: "–°—Ç–∏–≤ –î–∂–æ–±—Å"
  },
  {
    text: "–ù–µ –±–æ–π—Ç–µ—Å—å —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞. –í–∞–º –µ–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∏—á—å.",
    author: "–°–∞–ª—å–≤–∞–¥–æ—Ä –î–∞–ª–∏"
  },
  {
    text: "–í–∞—à–µ –≤—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –Ω–µ —Ç—Ä–∞—Ç—å—Ç–µ –µ–≥–æ, –∂–∏–≤—è —á—É–∂–æ–π –∂–∏–∑–Ω—å—é.",
    author: "–°—Ç–∏–≤ –î–∂–æ–±—Å"
  },
  {
    text: "–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –±—É–¥—É—â–µ–µ ‚Äî —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ.",
    author: "–ü–∏—Ç–µ—Ä –î—Ä—É–∫–µ—Ä"
  },
  {
    text: "–°–ª–æ–∂–Ω–µ–µ –≤—Å–µ–≥–æ –Ω–∞—á–∞—Ç—å –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç —É–ø–æ—Ä—Å—Ç–≤–∞.",
    author: "–ê–º–µ–ª–∏—è –≠—Ä—Ö–∞—Ä—Ç"
  },
  {
    text: "–¶–µ–ª—å ‚Äî —ç—Ç–æ –º–µ—á—Ç–∞ —Å –¥–µ–¥–ª–∞–π–Ω–æ–º.",
    author: "–ù–∞–ø–æ–ª–µ–æ–Ω –•–∏–ª–ª"
  },
  {
    text: "–ù–µ –∂–¥–∏—Ç–µ. –í—Ä–µ–º—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–º.",
    author: "–ù–∞–ø–æ–ª–µ–æ–Ω –•–∏–ª–ª"
  },
  {
    text: "–°–µ–∫—Ä–µ—Ç —É—Å–ø–µ—Ö–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.",
    author: "–ú–∞—Ä–∫ –¢–≤–µ–Ω"
  },
  {
    text: "–ü–æ–±–µ–¥–∞ ‚Äî —ç—Ç–æ –µ—â–µ –Ω–µ –≤—Å–µ, –Ω–æ –∂–µ–ª–∞–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç—å ‚Äî —ç—Ç–æ –≤—Å–µ.",
    author: "–í–∏–Ω—Å –õ–æ–º–±–∞—Ä–¥–∏"
  }
];

// üîß –¢–ï–õ–ï–ì–†–ê–ú –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
let tg = null;
let currentUser = null;
let userData = {
  role: 'mpp',
  history: [],
  settings: {},
  monthlyReports: []
};
let creditIds = [];
let reportCreditIds = [];
let monthlyReportCreditIds = [];
let currentTheme = localStorage.getItem('theme') || 'light';
let selectedWeek = null;

// üîß –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –†–ê–ë–û–¢–´ –° –ü–†–ò–õ–û–ñ–ï–ù–ò–ï–ú

// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
function showLoader(message = "–ó–∞–≥—Ä—É–∑–∫–∞...") {
  const loader = document.getElementById('globalLoader');
  const loaderText = document.querySelector('.loader-text');
  if (loader && loaderText) {
    loaderText.textContent = message;
    loader.style.display = 'flex';
  }
}

function hideLoader() {
  const loader = document.getElementById('globalLoader');
  if (loader) {
    loader.style.display = 'none';
  }
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
function showError(message) {
  const errorElement = document.getElementById('errorMessage');
  if (errorElement) {
    errorElement.textContent = message;
    errorElement.style.display = 'block';
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
      errorElement.style.display = 'none';
    }, 5000);
  }
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
function showSuccess(message) {
  const successElement = document.getElementById('successMessage');
  if (successElement) {
    successElement.textContent = message;
    successElement.style.display = 'block';
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
      successElement.style.display = 'none';
    }, 3000);
  }
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
function validateInput(value, min = 0, max = 1000000) {
  const num = parseInt(value);
  if (isNaN(num) || num < min) return min;
  if (num > max) return max;
  return num;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function checkAdminRights() {
  return userData.role === 'admin' && currentUser && currentUser.id !== 'demo';
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
window.addEventListener('error', function(e) {
  console.error('Global error:', e);
  showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏');
});

window.addEventListener('unhandledrejection', function(e) {
  console.error('Unhandled promise rejection:', e);
  showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏: ' + e.reason);
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞–Ω–∞–º–∏
function getDefaultPlans() {
  return {
    krh_plan: 14,
    vklad_volume_plan: 1920000,
    vklad_count_plan: 4,
    dk_count_plan: 2,
    dk_volume_plan: 960000,
    kvc_plan: 30
  };
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
async function getPlansForMonth(monthKey) {
  if (!firebaseInitialized) {
    return getDefaultPlans();
  }

  try {
    const plansDoc = await db.collection('plans').doc(monthKey).get();
    if (plansDoc.exists) {
      return plansDoc.data();
    } else {
      return getDefaultPlans();
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤:', error);
    return getDefaultPlans();
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–æ–≤ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
async function loadPlansIntoCalculator() {
  const now = new Date();
  const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
  
  try {
    const plans = await getPlansForMonth(currentMonthKey);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–Ω—ã –≤ –ø–æ–ª—è –≤–≤–æ–¥–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    document.getElementById('krh_plan').value = plans.krh_plan;
    document.getElementById('vklad_volume_plan').value = plans.vklad_volume_plan;
    document.getElementById('vklad_count_plan').value = plans.vklad_count_plan;
    document.getElementById('dk_count_plan').value = plans.dk_count_plan;
    document.getElementById('dk_volume_plan').value = plans.dk_volume_plan;
    document.getElementById('kvc_plan').value = plans.kvc_plan;
    
    console.log("–ü–ª–∞–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä:", plans);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–æ–≤ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä:', error);
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏
async function loadMotivationChanges() {
  if (!firebaseInitialized) return;
  
  try {
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    const changesDoc = await db.collection('motivation_changes').doc(currentMonthKey).get();
    
    if (changesDoc.exists) {
      const changesData = changesDoc.data();
      const notificationElement = document.getElementById('motivation-changes-notification');
      const contentElement = document.getElementById('motivation-changes-content');
      const dateElement = document.getElementById('motivation-changes-date');
      
      if (changesData.text && changesData.text.trim() !== '') {
        contentElement.innerHTML = changesData.text.replace(/\n/g, '<br>');
        dateElement.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(changesData.updatedAt?.toDate()).toLocaleDateString('ru-RU')}`;
        notificationElement.style.display = 'block';
      } else {
        notificationElement.style.display = 'none';
      }
    } else {
      document.getElementById('motivation-changes-notification').style.display = 'none';
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏:', error);
    document.getElementById('motivation-changes-notification').style.display = 'none';
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
async function loadAdminMotivationChanges() {
  if (!firebaseInitialized) return;
  
  try {
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    const changesDoc = await db.collection('motivation_changes').doc(currentMonthKey).get();
    
    if (changesDoc.exists) {
      const changesData = changesDoc.data();
      document.getElementById('changes-text').value = changesData.text || '';
    } else {
      document.getElementById('changes-text').value = '';
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:', error);
  }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏
async function saveMotivationChanges() {
  if (!checkAdminRights()) {
    showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏');
    return;
  }
  
  if (!firebaseInitialized) return;
  
  try {
    showLoader("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π...");
    
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    const changesText = document.getElementById('changes-text').value;
    
    await db.collection('motivation_changes').doc(currentMonthKey).set({
      text: changesText,
      monthKey: currentMonthKey,
      updatedBy: currentUser.id,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    hideLoader();
    showSuccess('–ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    await loadMotivationChanges();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:', error);
    hideLoader();
    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π');
  }
}

// –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ú–ï–ù–Æ
function initMenu() {
  const menuButton = document.getElementById('menuButton');
  const menuOverlay = document.getElementById('menuOverlay');
  const menuContainer = document.getElementById('menuContainer');
  const menuClose = document.getElementById('menuClose');
  const menuItems = document.querySelectorAll('.menu-item');
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
  menuButton.addEventListener('click', function(e) {
    e.stopPropagation();
    openMenu();
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
  menuClose.addEventListener('click', closeMenu);
  menuOverlay.addEventListener('click', closeMenu);
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É–Ω–∫—Ç
  menuItems.forEach(item => {
    item.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      if (tabId) {
        switchTab(tabId);
      }
      closeMenu();
    });
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeMenu();
    }
  });
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –≤ –º–µ–Ω—é
  const themeToggleInput = document.getElementById('themeToggleInput');
  themeToggleInput.addEventListener('change', toggleThemeFromMenu);
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ç–µ–º—ã
  updateThemeToggle();
}

function openMenu() {
  const menuOverlay = document.getElementById('menuOverlay');
  const menuContainer = document.getElementById('menuContainer');
  
  menuOverlay.style.display = 'block';
  setTimeout(() => {
    menuContainer.classList.add('active');
  }, 10);
  
  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞
  document.body.style.overflow = 'hidden';
}

function closeMenu() {
  const menuOverlay = document.getElementById('menuOverlay');
  const menuContainer = document.getElementById('menuContainer');
  
  menuContainer.classList.remove('active');
  setTimeout(() => {
    menuOverlay.style.display = 'none';
  }, 300);
  
  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ñ–æ–Ω–∞
  document.body.style.overflow = '';
}

function switchTab(tabId) {
  // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —É –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
  document.querySelectorAll('.menu-item').forEach(item => {
    item.classList.remove('active');
  });
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø—É–Ω–∫—Ç—É
  document.querySelector(`.menu-item[data-tab="${tabId}"]`).classList.add('active');
  
  // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
  document.getElementById(tabId).classList.add('active');
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
  updateHeaderTitle(tabId);
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
  loadTabData(tabId);
}

function updateHeaderTitle(tabId) {
  const headerTitle = document.getElementById('headerTitle');
  const headerSubtitle = document.getElementById('headerSubtitle');
  
  switch(tabId) {
    case 'home-tab':
      headerTitle.textContent = '–ì–ª–∞–≤–Ω–∞—è';
      headerSubtitle.textContent = '–ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–µ–º–∏–∏';
      break;
    case 'calculator-tab':
      headerTitle.textContent = '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–µ–º–∏–∏ –ú–ü–ü';
      headerSubtitle.textContent = '–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤–∞—à—É –ø—Ä–µ–º–∏—é –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º';
      break;
    case 'reports-tab':
      headerTitle.textContent = '–û—Ç—á–µ—Ç—ã';
      headerSubtitle.textContent = '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∏ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á–µ—Ç—ã';
      break;
    case 'leaderboard-tab':
      headerTitle.textContent = '–¢–æ–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤';
      headerSubtitle.textContent = '–†–µ–π—Ç–∏–Ω–≥–∏ –∏ —Ä–µ–∫–æ—Ä–¥—ã –ø—Ä–æ–¥–∞–∂';
      break;
    case 'profile-tab':
      headerTitle.textContent = '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å';
      headerSubtitle.textContent = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è';
      break;
    case 'admin-tab':
      headerTitle.textContent = '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å';
      headerSubtitle.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏';
      break;
  }
}

function loadTabData(tabId) {
  switch(tabId) {
    case 'home-tab':
      loadHomePageData();
      break;
    case 'leaderboard-tab':
      loadLeaderboard('week');
      break;
    case 'reports-tab':
      loadWeekOptions();
      loadMonthOptions();
      break;
    case 'profile-tab':
      loadProfile();
      break;
    case 'admin-tab':
      loadAdminPlans();
      break;
  }
}

function toggleThemeFromMenu() {
  toggleTheme();
  updateThemeToggle();
}

function updateThemeToggle() {
  const themeToggleInput = document.getElementById('themeToggleInput');
  themeToggleInput.checked = currentTheme === 'dark';
}

// üîß –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´
function loadHomePageData() {
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  updateWelcomeMessage();
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ç–∞—Ç—É
  setRandomQuote();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–µ–º–∏–∏
  loadPremiumForecast();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—ã—Å—Ç—Ä—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  loadQuickStats();
  
  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏
  document.getElementById('start-calculation-btn').addEventListener('click', function() {
    switchTab('calculator-tab');
  });
}

function updateWelcomeMessage() {
  const now = new Date();
  const hour = now.getHours();
  let greeting;
  
  if (hour >= 5 && hour < 12) {
    greeting = '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
  } else if (hour >= 12 && hour < 18) {
    greeting = '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
  } else if (hour >= 18 && hour < 23) {
    greeting = '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
  } else {
    greeting = '–î–æ–±—Ä–æ–π –Ω–æ—á–∏';
  }
  
  const userName = currentUser ? currentUser.firstName : '–ö–æ–ª–ª–µ–≥–∞';
  document.getElementById('welcome-title').textContent = `${greeting}, ${userName}!`;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
  const welcomeTexts = [
    `–°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!`,
    `–í–∞—à–∞ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –≤–µ–¥–µ—Ç –∫ —É—Å–ø–µ—Ö—É. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!`,
    `–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ –Ω–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.`,
    `–£–≤–µ—Ä–µ–Ω—ã, —Å–µ–≥–æ–¥–Ω—è –≤—ã —Å–º–æ–∂–µ—Ç–µ –¥–æ—Å—Ç–∏—á—å –æ—Ç–ª–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!`
  ];
  
  const randomText = welcomeTexts[Math.floor(Math.random() * welcomeTexts.length)];
  document.getElementById('welcome-text').textContent = randomText;
}

function setRandomQuote() {
  const randomIndex = Math.floor(Math.random() * MOTIVATIONAL_QUOTES.length);
  const quote = MOTIVATIONAL_QUOTES[randomIndex];
  
  document.getElementById('daily-quote').textContent = quote.text;
  document.getElementById('quote-author').textContent = quote.author;
}

async function loadPremiumForecast() {
  if (!currentUser || currentUser.id === 'demo' || !firebaseInitialized) {
    showDemoPremiumForecast();
    return;
  }
  
  try {
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    const monthlyReportQuery = await db.collection('monthlyReports')
      .where('userId', '==', String(currentUser.id))
      .where('monthKey', '==', currentMonthKey)
      .get();
    
    let currentPremium = 0;
    let forecastPremium = 0;
    
    if (!monthlyReportQuery.empty) {
      const report = monthlyReportQuery.docs[0].data();
      currentPremium = report.adjustedPremium || report.calculatedPremium || 0;
      forecastPremium = currentPremium;
    } else {
      // –ï—Å–ª–∏ –æ—Ç—á–µ—Ç–∞ –Ω–µ—Ç, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
      const weeklyReportsQuery = await db.collection('weeklyReports')
        .where('userId', '==', String(currentUser.id))
        .where('monthKey', '==', currentMonthKey)
        .get();
      
      let totalStats = {
        krh: 0,
        vkladCount: 0,
        dkCount: 0,
        credits: []
      };
      
      weeklyReportsQuery.forEach(doc => {
        const report = doc.data();
        totalStats.krh += report.krh || 0;
        totalStats.vkladCount += report.vkladCount || 0;
        totalStats.dkCount += report.dkCount || 0;
        
        if (report.credits) {
          totalStats.credits = totalStats.credits.concat(report.credits);
        }
      });
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      const weekCount = weeklyReportsQuery.size;
      const weeksInMonth = 4; // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å –≤ –º–µ—Å—è—Ü–µ
      
      if (weekCount > 0) {
        // –≠–∫—Å—Ç—Ä–∞–ø–æ–ª–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–µ—Å—å –º–µ—Å—è—Ü
        const multiplier = weeksInMonth / weekCount;
        const estimatedKrh = totalStats.krh * multiplier;
        const estimatedVkladCount = totalStats.vkladCount * multiplier;
        const estimatedDkCount = totalStats.dkCount * multiplier;
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–ª–∞–Ω—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
        const plans = await getPlansForMonth(currentMonthKey);
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥–Ω–æ–∑–Ω—É—é –ø—Ä–µ–º–∏—é
        forecastPremium = calculateEstimatedPremium({
          krh: estimatedKrh,
          vkladCount: estimatedVkladCount,
          dkCount: estimatedDkCount,
          creditsCount: totalStats.credits.length * multiplier
        }, plans);
        
        currentPremium = calculateEstimatedPremium({
          krh: totalStats.krh,
          vkladCount: totalStats.vkladCount,
          dkCount: totalStats.dkCount,
          creditsCount: totalStats.credits.length
        }, plans);
      }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.getElementById('premium-forecast-amount').textContent = Math.round(forecastPremium).toLocaleString() + ' ‚ÇΩ';
    document.getElementById('premium-forecast-period').textContent = `${MONTHS_GENITIVE[now.getMonth()]} ${now.getFullYear()}`;
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–µ–º–∏—è 100,000‚ÇΩ)
    const maxPremium = 100000;
    const progressPercent = Math.min((currentPremium / maxPremium) * 100, 100);
    document.getElementById('premium-forecast-progress').style.width = `${progressPercent}%`;
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω—é—é –ø—Ä–µ–º–∏—é –ø–æ –æ—Ç–¥–µ–ª—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    const averagePremium = await getAverageDepartmentPremium();
    let comparisonText = '';
    
    if (averagePremium > 0) {
      const difference = forecastPremium - averagePremium;
      const percentDiff = Math.round((difference / averagePremium) * 100);
      
      if (difference > 0) {
        comparisonText = `–ù–∞ ${Math.round(difference).toLocaleString()}‚ÇΩ (${percentDiff}%) –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –æ—Ç–¥–µ–ª—É`;
      } else if (difference < 0) {
        comparisonText = `–ù–∞ ${Math.abs(Math.round(difference)).toLocaleString()}‚ÇΩ (${Math.abs(percentDiff)}%) –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –æ—Ç–¥–µ–ª—É`;
      } else {
        comparisonText = `–ù–∞ —É—Ä–æ–≤–Ω–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –æ—Ç–¥–µ–ª—É`;
      }
    } else {
      comparisonText = `–≠—Ç–æ –≤–∞—à –ø–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ`;
    }
    
    document.getElementById('premium-forecast-comparison').textContent = comparisonText;
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø—Ä–µ–º–∏–∏:', error);
    showDemoPremiumForecast();
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ–π –ø—Ä–µ–º–∏–∏
function calculateEstimatedPremium(stats, plans) {
  // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
  const krhBonus = stats.krh * 600;
  const vkladBonus = stats.vkladCount * 200;
  const dkBonus = stats.dkCount * 1500; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç–∞
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã
  const extraBonus = stats.creditsCount >= 3 ? 5000 : 0;
  
  return krhBonus + vkladBonus + dkBonus + extraBonus;
}

async function getAverageDepartmentPremium() {
  if (!firebaseInitialized) return 0;
  
  try {
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ú–ü–ü
    const usersSnapshot = await db.collection('users')
      .where('role', '==', 'mpp')
      .get();
    
    if (usersSnapshot.empty) return 0;
    
    let totalPremium = 0;
    let userCount = 0;
    
    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞–µ–º –ø—Ä–µ–º–∏—é –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    for (const userDoc of usersSnapshot.docs) {
      const monthlyReportQuery = await db.collection('monthlyReports')
        .where('userId', '==', userDoc.id)
        .where('monthKey', '==', currentMonthKey)
        .get();
      
      if (!monthlyReportQuery.empty) {
        const report = monthlyReportQuery.docs[0].data();
        const premium = report.adjustedPremium || report.calculatedPremium || 0;
        totalPremium += premium;
        userCount++;
      }
    }
    
    return userCount > 0 ? totalPremium / userCount : 0;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π –ø—Ä–µ–º–∏–∏:', error);
    return 0;
  }
}

async function loadQuickStats() {
  if (!currentUser || currentUser.id === 'demo' || !firebaseInitialized) {
    showDemoQuickStats();
    return;
  }
  
  try {
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    // –ü–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    const monthlyReportQuery = await db.collection('monthlyReports')
      .where('userId', '==', String(currentUser.id))
      .where('monthKey', '==', currentMonthKey)
      .get();
    
    let credits = 0;
    let deposits = 0;
    let krh = 0;
    let strata = 0;
    
    if (!monthlyReportQuery.empty) {
      const report = monthlyReportQuery.docs[0].data();
      credits = report.dkCount || 0;
      deposits = report.vkladCount || 0;
      krh = report.krh || 0;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç—Ä–∞—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
      const plans = await getPlansForMonth(currentMonthKey);
      const krhPercent = plans.krh_plan > 0 ? Math.round((krh / plans.krh_plan) * 100) : (krh > 0 ? 100 : 0);
      strata = getStrataByPercent(krhPercent).strata;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    document.getElementById('quick-credits').textContent = credits;
    document.getElementById('quick-deposits').textContent = deposits;
    document.getElementById('quick-krh').textContent = krh;
    document.getElementById('quick-strata').textContent = strata;
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—ã—Å—Ç—Ä–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
    showDemoQuickStats();
  }
}

function showDemoPremiumForecast() {
  const now = new Date();
  const forecastPremium = 35000 + Math.floor(Math.random() * 15000);
  const currentPremium = 25000 + Math.floor(Math.random() * 10000);
  
  document.getElementById('premium-forecast-amount').textContent = forecastPremium.toLocaleString() + ' ‚ÇΩ';
  document.getElementById('premium-forecast-period').textContent = `${MONTHS_GENITIVE[now.getMonth()]} ${now.getFullYear()}`;
  
  const progressPercent = Math.min((currentPremium / 100000) * 100, 100);
  document.getElementById('premium-forecast-progress').style.width = `${progressPercent}%`;
  
  const comparisonText = `–ù–∞ ${Math.floor(Math.random() * 5000)}‚ÇΩ (+${Math.floor(Math.random() * 15)}%) –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ –æ—Ç–¥–µ–ª—É`;
  document.getElementById('premium-forecast-comparison').textContent = comparisonText;
}

function showDemoQuickStats() {
  document.getElementById('quick-credits').textContent = Math.floor(Math.random() * 10);
  document.getElementById('quick-deposits').textContent = Math.floor(Math.random() * 8);
  document.getElementById('quick-krh').textContent = Math.floor(Math.random() * 15);
  document.getElementById('quick-strata').textContent = Math.floor(Math.random() * 5) + 1;
}

// üîß –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–û–ù–´ –†–û–°–¢–ê
async function loadGrowthZone() {
  if (!currentUser || currentUser.id === 'demo' || !firebaseInitialized) {
    showDemoGrowthZone();
    return;
  }
  
  try {
    showLoader("–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π...");
    
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userMonthlyReportQuery = await db.collection('monthlyReports')
      .where('userId', '==', String(currentUser.id))
      .where('monthKey', '==', currentMonthKey)
      .get();
    
    let userStats = {
      premium: 0,
      credits: 0,
      deposits: 0,
      krh: 0,
      kvc: 0,
      additionalProducts: 0
    };
    
    if (!userMonthlyReportQuery.empty) {
      const report = userMonthlyReportQuery.docs[0].data();
      userStats.premium = report.adjustedPremium || report.calculatedPremium || 0;
      userStats.credits = report.dkCount || 0;
      userStats.deposits = report.vkladCount || 0;
      userStats.krh = report.krh || 0;
      userStats.kvc = report.kvc || 0;
      
      // –†–∞—Å—á–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
      userStats.additionalProducts = 
        (report.stickerCount || 0) +
        (report.yearSubCount || 0) +
        (report.monthSubCount || 0) +
        (report.krhLimitCount || 0) +
        (report.zpCardCount || 0) +
        (report.ompCount || 0) +
        (report.zpNerezCount || 0);
    }
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—É
    const departmentAverages = await getDepartmentAverages(currentMonthKey);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateComparisonStats(userStats, departmentAverages);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞
    updateWeakSpots(userStats, departmentAverages);
    
    hideLoader();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–æ–Ω—ã —Ä–æ—Å—Ç–∞:', error);
    hideLoader();
    showDemoGrowthZone();
  }
}

async function getDepartmentAverages(monthKey) {
  if (!firebaseInitialized) {
    return {
      premium: 35000,
      credits: 5,
      deposits: 6,
      krh: 12,
      kvc: 20,
      additionalProducts: 15
    };
  }
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ú–ü–ü
    const usersSnapshot = await db.collection('users')
      .where('role', '==', 'mpp')
      .get();
    
    if (usersSnapshot.empty) return null;
    
    let totals = {
      premium: 0,
      credits: 0,
      deposits: 0,
      krh: 0,
      kvc: 0,
      additionalProducts: 0
    };
    
    let reportCount = 0;
    
    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞–µ–º –æ—Ç—á–µ—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    for (const userDoc of usersSnapshot.docs) {
      const monthlyReportQuery = await db.collection('monthlyReports')
        .where('userId', '==', userDoc.id)
        .where('monthKey', '==', monthKey)
        .get();
      
      if (!monthlyReportQuery.empty) {
        const report = monthlyReportQuery.docs[0].data();
        
        totals.premium += report.adjustedPremium || report.calculatedPremium || 0;
        totals.credits += report.dkCount || 0;
        totals.deposits += report.vkladCount || 0;
        totals.krh += report.krh || 0;
        totals.kvc += report.kvc || 0;
        
        // –†–∞—Å—á–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        totals.additionalProducts += 
          (report.stickerCount || 0) +
          (report.yearSubCount || 0) +
          (report.monthSubCount || 0) +
          (report.krhLimitCount || 0) +
          (report.zpCardCount || 0) +
          (report.ompCount || 0) +
          (report.zpNerezCount || 0);
        
        reportCount++;
      }
    }
    
    if (reportCount === 0) return null;
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    return {
      premium: totals.premium / reportCount,
      credits: totals.credits / reportCount,
      deposits: totals.deposits / reportCount,
      krh: totals.krh / reportCount,
      kvc: totals.kvc / reportCount,
      additionalProducts: totals.additionalProducts / reportCount
    };
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π:', error);
    return null;
  }
}

function updateComparisonStats(userStats, departmentAverages) {
  if (!departmentAverages) {
    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–¥–µ–ª—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    showDemoGrowthZone();
    return;
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
  function formatComparison(userValue, avgValue) {
    if (avgValue === 0) return "0%";
    
    const diff = userValue - avgValue;
    const percentDiff = Math.round((diff / avgValue) * 100);
    
    return `${diff >= 0 ? '+' : ''}${percentDiff}%`;
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π)
  function getComparisonClass(userValue, avgValue) {
    if (avgValue === 0) return "neutral";
    
    const diff = userValue - avgValue;
    const percentDiff = Math.round((diff / avgValue) * 100);
    
    if (percentDiff > 10) return "positive";
    if (percentDiff < -10) return "negative";
    return "neutral";
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
  const premiumComparison = formatComparison(userStats.premium, departmentAverages.premium);
  const premiumClass = getComparisonClass(userStats.premium, departmentAverages.premium);
  
  const creditsComparison = formatComparison(userStats.credits, departmentAverages.credits);
  const creditsClass = getComparisonClass(userStats.credits, departmentAverages.credits);
  
  const depositsComparison = formatComparison(userStats.deposits, departmentAverages.deposits);
  const depositsClass = getComparisonClass(userStats.deposits, departmentAverages.deposits);
  
  const krhComparison = formatComparison(userStats.krh, departmentAverages.krh);
  const krhClass = getComparisonClass(userStats.krh, departmentAverages.krh);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  const premiumElement = document.getElementById('growth-premium-comparison');
  premiumElement.textContent = premiumComparison;
  premiumElement.className = `growth-stat-value ${premiumClass}`;
  
  const creditsElement = document.getElementById('growth-credits-comparison');
  creditsElement.textContent = creditsComparison;
  creditsElement.className = `growth-stat-value ${creditsClass}`;
  
  const depositsElement = document.getElementById('growth-deposits-comparison');
  depositsElement.textContent = depositsComparison;
  depositsElement.className = `growth-stat-value ${depositsClass}`;
  
  const krhElement = document.getElementById('growth-krh-comparison');
  krhElement.textContent = krhComparison;
  krhElement.className = `growth-stat-value ${krhClass}`;
}

function updateWeakSpots(userStats, departmentAverages) {
  if (!departmentAverages) return;
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ (–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –Ω–∞ 20% –∏–ª–∏ –±–æ–ª—å—à–µ)
  const weakSpots = [];
  
  if (departmentAverages.kvc > 0 && userStats.kvc < departmentAverages.kvc * 0.8) {
    const percentDiff = Math.round(((userStats.kvc - departmentAverages.kvc) / departmentAverages.kvc) * 100);
    weakSpots.push({
      name: '–ö–í–¶ –∫–ª–∏–µ–Ω—Ç—ã',
      description: `–ù–∞ ${Math.abs(percentDiff)}% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è`,
      value: Math.round(userStats.kvc),
      percent: percentDiff
    });
  }
  
  if (departmentAverages.additionalProducts > 0 && userStats.additionalProducts < departmentAverages.additionalProducts * 0.8) {
    const percentDiff = Math.round(((userStats.additionalProducts - departmentAverages.additionalProducts) / departmentAverages.additionalProducts) * 100);
    weakSpots.push({
      name: '–î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã',
      description: `–ù–∞ ${Math.abs(percentDiff)}% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è`,
      value: Math.round(userStats.additionalProducts),
      percent: percentDiff
    });
  }
  
  if (departmentAverages.credits > 0 && userStats.credits < departmentAverages.credits * 0.8) {
    const percentDiff = Math.round(((userStats.credits - departmentAverages.credits) / departmentAverages.credits) * 100);
    weakSpots.push({
      name: '–ö—Ä–µ–¥–∏—Ç—ã',
      description: `–ù–∞ ${Math.abs(percentDiff)}% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è`,
      value: Math.round(userStats.credits),
      percent: percentDiff
    });
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  const weakSpotsList = document.getElementById('weak-spots-list');
  
  if (weakSpots.length === 0) {
    weakSpotsList.innerHTML = `
      <div class="weak-spot-item">
        <div class="weak-spot-info">
          <div class="weak-spot-name">–í—Å–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –Ω–æ—Ä–º–µ</div>
          <div class="weak-spot-description">–í–∞—à–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –ø—Ä–µ–≤—ã—à–∞—é—Ç —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –æ—Ç–¥–µ–ª—É</div>
        </div>
        <div class="weak-spot-value" style="color: var(--success);">
          –û—Ç–ª–∏—á–Ω–æ!
        </div>
      </div>
    `;
  } else {
    weakSpotsList.innerHTML = weakSpots.map(spot => `
      <div class="weak-spot-item">
        <div class="weak-spot-info">
          <div class="weak-spot-name">${spot.name}</div>
          <div class="weak-spot-description">${spot.description}</div>
        </div>
        <div class="weak-spot-value">
          ${spot.value}<span class="weak-spot-percent">(${spot.percent}%)</span>
        </div>
      </div>
    `).join('');
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç
  updateRecommendations(weakSpots);
}

function updateRecommendations(weakSpots) {
  const recommendationsList = document.getElementById('recommendations-list');
  
  const allRecommendations = [
    "–£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ö–í–¶ –∫–ª–∏–µ–Ω—Ç–æ–≤. –¶–µ–ª–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: 25+ –≤ –Ω–µ–¥–µ–ª—é",
    "–ê–∫—Ç–∏–≤–Ω–µ–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (—Å—Ç–∏–∫–µ—Ä—ã, –ø–æ–¥–ø–∏—Å–∫–∏)",
    "–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ 3+ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –º–µ—Å—è—Ü –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫—Å—Ç—Ä–∞–±–æ–Ω—É—Å–∞",
    "–£–ª—É—á—à–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ–∑–≤–æ–Ω–æ–≤ CRM –¥–æ 50+ –≤ –Ω–µ–¥–µ–ª—é",
    "–£–≤–µ–ª–∏—á—å—Ç–µ –æ–±—ä–µ–º –ø—Ä–æ–¥–∞–∂ –∫—Ä–µ–¥–∏—Ç–æ–≤ - –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –ø–∞–∫–µ—Ç—ã –∑–∞—â–∏—Ç—ã",
    "–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∫–ª–∞–¥–æ–≤ - –º–∏–Ω–∏–º—É–º 1 –≤ –Ω–µ–¥–µ–ª—é",
    "–°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–ª–∞–Ω–æ–≤ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º",
    "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏ —Å—Ç–∞–≤—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ –∏—Ö —É–ª—É—á—à–µ–Ω–∏—é"
  ];
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç
  let filteredRecommendations = [...allRecommendations];
  
  weakSpots.forEach(spot => {
    if (spot.name === '–ö–í–¶ –∫–ª–∏–µ–Ω—Ç—ã') {
      filteredRecommendations = filteredRecommendations.filter(rec => 
        rec.includes('–ö–í–¶') || rec.includes('–∫–ª–∏–µ–Ω—Ç')
      );
    } else if (spot.name === '–î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã') {
      filteredRecommendations = filteredRecommendations.filter(rec => 
        rec.includes('–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã') || rec.includes('—Å—Ç–∏–∫–µ—Ä—ã') || rec.includes('–ø–æ–¥–ø–∏—Å–∫–∏')
      );
    } else if (spot.name === '–ö—Ä–µ–¥–∏—Ç—ã') {
      filteredRecommendations = filteredRecommendations.filter(rec => 
        rec.includes('–∫—Ä–µ–¥–∏—Ç') || rec.includes('–ø–∞–∫–µ—Ç—ã –∑–∞—â–∏—Ç—ã')
      );
    }
  });
  
  // –ë–µ—Ä–µ–º 4 —Å–∞–º—ã–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  const selectedRecommendations = filteredRecommendations.slice(0, 4);
  
  // –ï—Å–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ
  if (selectedRecommendations.length < 4) {
    const generalRecommendations = allRecommendations.filter(rec => 
      !selectedRecommendations.includes(rec)
    );
    selectedRecommendations.push(...generalRecommendations.slice(0, 4 - selectedRecommendations.length));
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  recommendationsList.innerHTML = selectedRecommendations.map(rec => `
    <div class="recommendation-item">
      <div class="recommendation-icon"><i class="fas fa-check-circle"></i></div>
      <div class="recommendation-text">${rec}</div>
    </div>
  `).join('');
}

function showDemoGrowthZone() {
  // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–æ–Ω—ã —Ä–æ—Å—Ç–∞
  document.getElementById('growth-premium-comparison').textContent = '+15%';
  document.getElementById('growth-premium-comparison').className = 'growth-stat-value positive';
  
  document.getElementById('growth-credits-comparison').textContent = '-5%';
  document.getElementById('growth-credits-comparison').className = 'growth-stat-value neutral';
  
  document.getElementById('growth-deposits-comparison').textContent = '+22%';
  document.getElementById('growth-deposits-comparison').className = 'growth-stat-value positive';
  
  document.getElementById('growth-krh-comparison').textContent = '-30%';
  document.getElementById('growth-krh-comparison').className = 'growth-stat-value negative';
}

// üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –í–ö–õ–ê–î–û–ö –ü–†–û–§–ò–õ–Ø
function initProfileTabs() {
  const profileTabs = document.querySelectorAll('.profile-tab');
  
  profileTabs.forEach(tab => {
    tab.addEventListener('click', function() {
      // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
      profileTabs.forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.profile-content').forEach(c => c.classList.remove('active'));
      
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
      this.classList.add('active');
      const tabId = this.getAttribute('data-tab');
      document.getElementById(tabId).classList.add('active');
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
      if (tabId === 'profile-growth-tab') {
        loadGrowthZone();
      } else if (tabId === 'profile-history-tab') {
        loadFullPremiumHistory();
      } else if (tabId === 'profile-badges-tab') {
        loadAchievements();
      }
    });
  });
}

async function loadFullPremiumHistory() {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ –∏ –¥–ª—è –∫—Ä–∞—Ç–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏
  await loadPremiumHistory();
  
  // –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
  const shortHistory = document.getElementById('premium-history-list').innerHTML;
  document.getElementById('full-premium-history-list').innerHTML = shortHistory;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  document.querySelectorAll('#full-premium-history-list .edit-premium-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const reportId = this.getAttribute('data-report-id');
      const monthName = this.getAttribute('data-month');
      if (reportId) {
        editMonthlyPremium(reportId, monthName);
      }
    });
  });
}

// üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –¢–ï–õ–ï–ì–†–ê–ú –ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
async function initTelegram() {
  try {
    tg = window.Telegram.WebApp;
    tg.expand();
    console.log("Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
    
    const user = tg.initDataUnsafe.user;
    if (user) {
      currentUser = {
        id: user.id,
        firstName: user.first_name,
        lastName: user.last_name || '',
        username: user.username
      };
      showUserInfo();
      await loadUserData();
    } else {
      currentUser = {
        id: 'demo',
        firstName: '–î–µ–º–æ',
        lastName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
      };
      showUserInfo();
      initializeApp();
    }
    
    if (tg.colorScheme === 'dark') {
      currentTheme = 'dark';
      document.documentElement.setAttribute('data-theme', 'dark');
    } else {
      currentTheme = 'light';
      document.documentElement.setAttribute('data-theme', 'light');
    }
    updateThemeIcon();
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram:", error);
    currentUser = {
      id: 'demo',
      firstName: '–î–µ–º–æ',
      lastName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    };
    showUserInfo();
    initializeApp();
  }
}

function showUserInfo() {
  const userAvatar = document.getElementById('userAvatar');
  const menuUserAvatar = document.getElementById('menuUserAvatar');
  const menuUserName = document.getElementById('menuUserName');
  const menuUserRole = document.getElementById('menuUserRole');
  
  const displayName = currentUser.firstName + (currentUser.lastName ? ' ' + currentUser.lastName : '');
  const firstLetter = currentUser.firstName ? currentUser.firstName.charAt(0).toUpperCase() : 'U';
  
  if (userAvatar) userAvatar.textContent = firstLetter;
  if (menuUserAvatar) menuUserAvatar.textContent = firstLetter;
  if (menuUserName) menuUserName.textContent = displayName;
}

function updateThemeIcon() {
  const themeIcon = document.querySelector('#themeToggle i');
  if (themeIcon) {
    themeIcon.className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
  }
}

function toggleTheme() {
  currentTheme = currentTheme === 'light' ? 'dark' : 'light';
  localStorage.setItem('theme', currentTheme);
  document.documentElement.setAttribute('data-theme', currentTheme);
  updateThemeIcon();
  updateThemeToggle();
}

async function initializeApp() {
  document.querySelector('.container').style.display = 'block';
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é
  initMenu();
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è
  initProfileTabs();
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
  setupNavigation();
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–≤–æ–¥–∞
  setupInputValidation();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–∞–Ω—ã –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
  await loadPlansIntoCalculator();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏
  await loadMotivationChanges();
  
  initializeMPPCalculator();
  initializeReports();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ú–ü–ü
  if (!checkAdminRights()) {
    await loadProfile();
  }
  
  loadWeekOptions();
  loadMonthOptions();
  
  if (!checkAdminRights()) {
    await loadLeaderboard('week');
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞
  if (checkAdminRights()) {
    await initializeAdminPanel();
  }
  
  addCredit();
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é
  updateUserRoleInMenu();
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  await loadHomePageData();
}

function setupNavigation() {
  const isAdmin = checkAdminRights();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø—É–Ω–∫—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ –º–µ–Ω—é
  const adminMenuItem = document.querySelector('.menu-item.admin-only');
  if (adminMenuItem) {
    adminMenuItem.style.display = isAdmin ? 'flex' : 'none';
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é
  updateUserRoleInMenu();
}

function updateUserRoleInMenu() {
  const menuUserRole = document.getElementById('menuUserRole');
  if (menuUserRole) {
    menuUserRole.textContent = userData.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ú–ü–ü';
    if (userData.role === 'admin') {
      menuUserRole.style.color = '#e74c3c';
      menuUserRole.style.fontWeight = 'bold';
    }
  }
}

function setupInputValidation() {
  document.querySelectorAll('input[type="number"]').forEach(input => {
    input.addEventListener('change', function() {
      const min = parseInt(this.getAttribute('min')) || 0;
      const max = parseInt(this.getAttribute('max')) || 1000000;
      this.value = validateInput(this.value, min, max);
    });
    
    input.addEventListener('input', function() {
      const min = parseInt(this.getAttribute('min')) || 0;
      const max = parseInt(this.getAttribute('max')) || 1000000;
      const value = parseInt(this.value);
      
      if (!isNaN(value) && (value < min || value > max)) {
        this.style.borderColor = 'var(--accent)';
      } else {
        this.style.borderColor = 'var(--border-color)';
      }
    });
  });
}

async function loadUserData() {
  if (!currentUser || currentUser.id === 'demo' || !firebaseInitialized) {
    initializeApp();
    return;
  }

  try {
    showLoader("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...");
    const userDoc = await db.collection('users').doc(String(currentUser.id)).get();
    if (userDoc.exists) {
      const data = userDoc.data();
      userData.role = data.role || 'mpp';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–æ–ª–∏
      updateUserRoleInMenu();
      
      await db.collection('users').doc(String(currentUser.id)).set({
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });
    } else {
      await db.collection('users').doc(String(currentUser.id)).set({
        telegramUserId: currentUser.id,
        firstName: currentUser.firstName,
        lastName: currentUser.lastName,
        username: currentUser.username,
        role: 'mpp',
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });
      
      userData.role = 'mpp';
      updateUserRoleInMenu();
    }
    hideLoader();
    initializeApp();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    hideLoader();
    showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    initializeApp();
  }
}

// üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–°–ß–ï–¢–ê –ü–†–ï–ú–ò–ò (–ú–ü–ü)

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç—ã –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—è –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
function getStrataByPercent(percent) {
  for (let rule of STRATA_RULES) {
    if (percent >= rule.min) {
      return rule;
    }
  }
  return STRATA_RULES[STRATA_RULES.length - 1];
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç—ã –ø–æ –±–∞–ª–ª–∞–º
function getFinalStrata(points) {
  for (let rule of FINAL_STRATA_RULES) {
    if (points >= rule.min) {
      return rule.strata;
    }
  }
  return 20;
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫—Ä—É–≥–æ–≤–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
function drawPremiumPieChart(data) {
  const canvas = document.getElementById('premium-chart');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  const container = canvas.parentElement;
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  canvas.width = container.offsetWidth;
  canvas.height = container.offsetHeight;
  
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = Math.min(centerX, centerY) - 10;
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  if (!data || data.length === 0 || data.reduce((sum, item) => sum + item.value, 0) === 0) {
    ctx.fillStyle = '#f0f0f0';
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
    ctx.fill();
    ctx.fillStyle = '#999';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.font = '14px Arial';
    ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', centerX, centerY);
    return;
  }
  
  const total = data.reduce((sum, item) => sum + item.value, 0);
  let startAngle = 0;
  
  data.forEach((item, index) => {
    const sliceAngle = (item.value / total) * 2 * Math.PI;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
    ctx.closePath();
    ctx.fillStyle = item.color;
    ctx.fill();
    startAngle += sliceAngle;
  });
  
  document.getElementById('chart-total').textContent = Math.round(total).toLocaleString() + ' ‚ÇΩ';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã –¥–∏–∞–≥—Ä–∞–º–º—ã
function updateChartLegend(data) {
  const legendContainer = document.getElementById('chart-legend');
  const total = data.reduce((sum, item) => sum + item.value, 0);
  
  legendContainer.innerHTML = data.map((item, index) => {
    const percentage = total > 0 ? Math.round((item.value / total) * 100) : 0;
    return `
      <div class="legend-item">
        <div class="legend-color" style="background-color: ${item.color};"></div>
        <div class="legend-label">${item.label}</div>
        <div class="legend-value">${Math.round(item.value).toLocaleString()} ‚ÇΩ (${percentage}%)</div>
      </div>
    `;
  }).join('');
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏
async function calculatePremium() {
  try {
    showLoader("–†–∞—Å—á–µ—Ç –ø—Ä–µ–º–∏–∏...");
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    const now = new Date();
    const currentMonthKey = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
    const currentPlans = await getPlansForMonth(currentMonthKey);
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–ª–∞–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    const krhPlan = currentPlans.krh_plan;
    const vkladVolumePlan = currentPlans.vklad_volume_plan;
    const vkladCountPlan = currentPlans.vklad_count_plan;
    const dkCountPlan = currentPlans.dk_count_plan;
    const dkVolumePlan = currentPlans.dk_volume_plan;
    const kvcPlan = currentPlans.kvc_plan;

    // –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä–µ–º –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    const krhFact = validateInput(document.getElementById('krh_fact').value, 0, 1000);
    const krhPercent = krhPlan > 0 ? Math.round((krhFact / krhPlan) * 100) : (krhFact > 0 ? 100 : 0);

    const vkladVolumeFact = validateInput(document.getElementById('vklad_volume_fact').value, 0, 100000000);
    const vkladVolumePercent = vkladVolumePlan > 0 ? Math.round((vkladVolumeFact / vkladVolumePlan) * 100) : (vkladVolumeFact > 0 ? 100 : 0);

    const dkVolumeFact = validateInput(document.getElementById('dk_volume_fact').value, 0, 100000000);
    const dkVolumePercent = dkVolumePlan > 0 ? Math.round((dkVolumeFact / dkVolumePlan) * 100) : (dkVolumeFact > 0 ? 100 : 0);

    const kvcFact = validateInput(document.getElementById('kvc_fact').value, 0, 1000);
    const kvcPercent = kvcPlan > 0 ? Math.round((kvcFact / kvcPlan) * 100) : (kvcFact > 0 ? 100 : 0);

    const krhStrata = getStrataByPercent(krhPercent);
    const vkladStrata = getStrataByPercent(vkladVolumePercent);
    const dkStrata = getStrataByPercent(dkVolumePercent);
    const kvcStrata = getStrataByPercent(kvcPercent);

    document.getElementById('plan_results').innerHTML = `
      –ö–†–•: ${krhFact}/${krhPlan} = ${krhPercent}% <span class="strata-badge">–°—Ç—Ä–∞—Ç–∞ ${krhStrata.strata}</span> <span class="multiplier-badge">√ó${krhStrata.multiplier}</span> <span class="points-badge">${krhStrata.points} –±–∞–ª–ª–æ–≤</span><br>
      –í–∫–ª–∞–¥ –æ–±—ä–µ–º: ${vkladVolumeFact.toLocaleString()}/${vkladVolumePlan.toLocaleString()} = ${vkladVolumePercent}% <span class="strata-badge">–°—Ç—Ä–∞—Ç–∞ ${vkladStrata.strata}</span> <span class="multiplier-badge">√ó${vkladStrata.multiplier}</span> <span class="points-badge">${vkladStrata.points} –±–∞–ª–ª–æ–≤</span><br>
      –î–ö –æ–±—ä–µ–º: ${dkVolumeFact.toLocaleString()}/${dkVolumePlan.toLocaleString()} = ${dkVolumePercent}% <span class="strata-badge">–°—Ç—Ä–∞—Ç–∞ ${dkStrata.strata}</span> <span class="multiplier-badge">√ó${dkStrata.multiplier}</span> <span class="points-badge">${dkStrata.points} –±–∞–ª–ª–æ–≤</span><br>
      –ö–í–¶: ${kvcFact}/${kvcPlan} = ${kvcPercent}% <span class="strata-badge">–°—Ç—Ä–∞—Ç–∞ ${kvcStrata.strata}</span> <span class="multiplier-badge">√ó${kvcStrata.multiplier}</span> <span class="points-badge">${kvcStrata.points} –±–∞–ª–ª–æ–≤</span>
    `;

    let dkSum = 0;
    let eligibleCreditsCount = 0;
    const creditPremiumInputs = document.querySelectorAll('input[id^="credit-premium-"]');
    creditPremiumInputs.forEach(premiumInput => {
      const creditPremiumText = premiumInput.value;
      const creditPremium = parseInt(creditPremiumText.replace(/\s/g, '').replace('‚ÇΩ', '')) || 0;
      
      if (dkVolumePercent >= 70) {
        dkSum += creditPremium;
      } else {
        const creditRow = premiumInput.closest('.credit-row');
        const typeSelect = creditRow.querySelector('.credit-type');
        if (typeSelect) {
          const creditType = typeSelect.value;
          const creditConfig = CREDIT_TYPES[creditType];
          dkSum += creditConfig.base;
        }
      }
      
      if (creditPremium > 0) {
        eligibleCreditsCount++;
      }
    });
    
    const dkSumAfterMultiplier = dkSum * dkStrata.multiplier;

    const vkladCountFact = validateInput(document.getElementById('vklad_count_fact').value, 0, 1000);
    const vkladySum = vkladCountFact * 200;
    const vkladySumAfterMultiplier = vkladySum * vkladStrata.multiplier;

    const startedKrhSum = krhFact * 600;
    const startedKrhSumAfterMultiplier = startedKrhSum * krhStrata.multiplier;

    const mainProductsSum = dkSumAfterMultiplier + vkladySumAfterMultiplier + startedKrhSumAfterMultiplier;

    let otherProductsSum = 0;
    const stickerCount = validateInput(document.getElementById('sticker_count').value, 0, 1000);
    const stickerSum = stickerCount * 50;

    const yearSubCount = validateInput(document.getElementById('year_sub_count').value, 0, 1000);
    const yearSubSum = yearSubCount * 500;

    const monthSubCount = validateInput(document.getElementById('month_sub_count').value, 0, 1000);
    const monthSubSum = monthSubCount * 200;

    const krhLimitCount = validateInput(document.getElementById('krh_limit_count').value, 0, 1000);
    const krhLimitSum = krhLimitCount * 100;

    const zpCardCount = validateInput(document.getElementById('zp_card_count').value, 0, 1000);
    const zpCardSum = zpCardCount * 100;

    const ompCount = validateInput(document.getElementById('omp_count').value, 0, 1000);
    const ompSum = ompCount * 50;

    const zpNerezCount = validateInput(document.getElementById('zp_nerez_count').value, 0, 1000);
    const zpNerezSum = zpNerezCount * 300;

    const cardTurnover = validateInput(document.getElementById('card_turnover').value, 0, 100000000);
    const cardTurnoverSum = Math.min(cardTurnover * 0.03, 100000);

    const skbCount = validateInput(document.getElementById('skb_count').value, 0, 1000);
    const crmCalls = validateInput(document.getElementById('crm_calls').value, 0, 1000);

    otherProductsSum = stickerSum + yearSubSum + monthSubSum + krhLimitSum + zpCardSum + ompSum + zpNerezSum + cardTurnoverSum;

    document.getElementById('payments_results').innerHTML = `
      –ö—Ä–µ–¥–∏—Ç—ã: ${dkSum.toLocaleString()}‚ÇΩ √ó ${dkStrata.multiplier} = ${dkSumAfterMultiplier.toLocaleString()}‚ÇΩ<br>
      –í–∫–ª–∞–¥—ã: ${vkladySum.toLocaleString()}‚ÇΩ √ó ${vkladStrata.multiplier} = ${vkladySumAfterMultiplier.toLocaleString()}‚ÇΩ<br>
      –ö–†–•: ${startedKrhSum.toLocaleString()}‚ÇΩ √ó ${krhStrata.multiplier} = ${startedKrhSumAfterMultiplier.toLocaleString()}‚ÇΩ<br>
      –î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã: ${otherProductsSum.toLocaleString()}‚ÇΩ
    `;

    let skbPoints = 0;
    let crmPoints = 0;
    skbPoints = skbCount < 3 ? 1 : -1;
    if (crmCalls <= 50) {
      crmPoints = 2;
    } else if (crmCalls > 50 && crmCalls < 60) {
      crmPoints = 0;
    } else {
      crmPoints = -2;
    }

    document.getElementById('championship_results').innerHTML = `
      –°–ö–ë: ${skbCount} —à—Ç. ‚Üí ${skbPoints > 0 ? '+' : ''}${skbPoints} –±–∞–ª–ª<br>
      –î–æ–∑–≤–æ–Ω—ã: ${crmCalls} ‚Üí ${crmPoints > 0 ? '+' : ''}${crmPoints} –±–∞–ª–ª–æ–≤<br>
      –ò—Ç–æ–≥–æ –ß–ü: ${skbPoints + crmPoints} –±–∞–ª–ª–æ–≤
    `;

    const totalPoints = krhStrata.points + vkladStrata.points + dkStrata.points + kvcStrata.points;
    const championshipPoints = skbPoints + crmPoints;
    const finalPoints = totalPoints + championshipPoints;
    const finalStrata = getFinalStrata(finalPoints);

    document.getElementById('final_strata_calculation').innerHTML = `
      –°—É–º–º–∞ –±–∞–ª–ª–æ–≤ –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º: ${krhStrata.points} + ${vkladStrata.points} + ${dkStrata.points} + ${kvcStrata.points} = ${totalPoints} –±–∞–ª–ª–æ–≤<br>
      –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ß–ü: ${championshipPoints} –±–∞–ª–ª–æ–≤<br>
      –ò—Ç–æ–≥–æ–≤—ã–µ –±–∞–ª–ª—ã: ${totalPoints} + ${championshipPoints} = ${finalPoints} –±–∞–ª–ª–æ–≤<br>
      <strong>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–∞: <span class="final-strata-badge">${finalStrata}</span></strong>
    `;

    const positionBonus = parseInt(document.getElementById('position').value) || 0;
    const moscowCoef = parseFloat(document.getElementById('moscow_coef').value) || 1;

    const extraBonus = eligibleCreditsCount >= 3 ? 5000 : 0;

    const sumBeforeMoscow = mainProductsSum + otherProductsSum;
    const sumAfterMoscow = sumBeforeMoscow * moscowCoef;
    const finalPremium = sumAfterMoscow + extraBonus + positionBonus;

    let detailedHTML = '';
    detailedHTML = `
      <div class="detail-item">
        <span class="detail-label">–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</span>
        <span class="detail-value">${mainProductsSum.toLocaleString()}‚ÇΩ</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">–î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã:</span>
        <span class="detail-value">${otherProductsSum.toLocaleString()}‚ÇΩ</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">–°—É–º–º–∞ –¥–æ —Ä–µ–≥–∏–æ–Ω. –∫–æ—ç—Ñ.:</span>
        <span class="detail-value">${sumBeforeMoscow.toLocaleString()}‚ÇΩ</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">–†–µ–≥–∏–æ–Ω. –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (${moscowCoef}):</span>
        <span class="detail-value">${sumAfterMoscow.toLocaleString()}‚ÇΩ</span>
      </div>
    `;
    
    if (extraBonus > 0) {
      detailedHTML += `
        <div class="detail-item">
          <span class="detail-label">–≠–∫—Å—Ç—Ä–∞–±–æ–Ω—É—Å –∑–∞ 3+ –∫—Ä–µ–¥–∏—Ç–∞:</span>
          <span class="detail-value">+${extraBonus.toLocaleString()}‚ÇΩ</span>
        </div>
      `;
    }
    
    detailedHTML += `
      <div class="detail-item">
        <span class="detail-label">–ù–∞–¥–±–∞–≤–∫–∞ –∑–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å:</span>
        <span class="detail-value">+${positionBonus.toLocaleString()}‚ÇΩ</span>
      </div>
    `;
    
    document.getElementById('detailed_calculation').innerHTML = detailedHTML;

    document.getElementById('final_premium').textContent = Math.round(finalPremium).toLocaleString() + ' ‚ÇΩ';
    document.getElementById('results').style.display = 'block';
    
    const chartData = [
      { label: '–ö—Ä–µ–¥–∏—Ç—ã', value: dkSumAfterMultiplier, color: CHART_COLORS[0] },
      { label: '–í–∫–ª–∞–¥—ã', value: vkladySumAfterMultiplier, color: CHART_COLORS[1] },
      { label: '–ö–†–•', value: startedKrhSumAfterMultiplier, color: CHART_COLORS[2] },
      { label: '–î–æ–ø. –ø—Ä–æ–¥—É–∫—Ç—ã', value: otherProductsSum, color: CHART_COLORS[3] }
    ];
    
    if (extraBonus > 0) {
      chartData.push({ label: '–≠–∫—Å—Ç—Ä–∞–±–æ–Ω—É—Å', value: extraBonus, color: CHART_COLORS[4] });
    }
    
    if (positionBonus > 0) {
      chartData.push({ label: '–ù–∞–¥–±–∞–≤–∫–∞ –∑–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å', value: positionBonus, color: CHART_COLORS[5] });
    }
    
    const filteredData = chartData.filter(item => item.value > 0);
    drawPremiumPieChart(filteredData);
    updateChartLegend(filteredData);
    
    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    
    hideLoader();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–µ–º–∏–∏:', error);
    hideLoader();
    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –ø—Ä–µ–º–∏–∏: ' + error.message);
  }
}

// üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï

document.addEventListener('DOMContentLoaded', async function() {
  console.log("DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...");
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase –¥–æ –≤—Å–µ–≥–æ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ
  await initializeFirebase();
  
  initTelegram();
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–µ–º—ã
  currentTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', currentTheme);
  updateThemeToggle();
  updateThemeIcon();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ –≤ —Ç–æ–ø–µ
  document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      const period = this.getAttribute('data-period');
      loadLeaderboard(period);
    });
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤
  document.getElementById('save-record-btn').addEventListener('click', saveRecord);

  console.log("–í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã");
});

// üîß –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–í–´–†–ï–ó–ê–ù–û –î–õ–Ø –ö–û–ú–ü–ê–ö–¢–ù–û–°–¢–ò)
// –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞:
// - initializeMPPCalculator, initializeReports, addCredit, updateCreditPremium –∏ —Ç.–¥.
// - saveWeeklyReport, saveMonthlyReport, loadLeaderboard –∏ –¥—Ä—É–≥–∏–µ
// - loadProfile, loadAchievements, loadPremiumHistory, loadProfileStats
// - initializeAdminPanel, loadAdminPlans, saveAdminPlans
// - initializeUserSearch, searchUsers, loadSalesRecords, saveRecord
// - –ò –¥—Ä—É–≥–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

// –ü–æ—Å–∫–æ–ª—å–∫—É –∫–æ–¥ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π, —è –≤—ã—Ä–µ–∑–∞–ª –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏.
// –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞.

// –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –∑–¥–µ—Å—å —è –¥–æ–±–∞–≤–ª—è—é –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ:

// –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
function initializeMPPCalculator() {
  document.getElementById('add-credit-btn').addEventListener('click', addCredit);
  document.getElementById('calculate-btn').addEventListener('click', calculatePremium);
}

function initializeReports() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
}

function addCredit() {
  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞
}

function updateCreditPremium(id) {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–º–∏–∏ –∑–∞ –∫—Ä–µ–¥–∏—Ç
}

async function saveWeeklyReport() {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
}

async function saveMonthlyReport() {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Å—è—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
}

async function loadLeaderboard(period) {
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞
}

async function loadProfile() {
  await loadAchievements();
  await loadPremiumHistory();
  await loadProfileStats();
}

async function loadAchievements() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
}

async function loadPremiumHistory() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–º–∏–π
}

async function loadProfileStats() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
}

async function initializeAdminPanel() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
}

async function loadAdminPlans() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–Ω–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞
}

async function saveAdminPlans() {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –∞–¥–º–∏–Ω–æ–º
}

function initializeUserSearch() {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
}

async function searchUsers() {
  // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
}

async function loadSalesRecords() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ –ø—Ä–æ–¥–∞–∂
}

async function saveRecord() {
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
}

// üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –†–ê–ë–û–ß–ò–• –ù–ï–î–ï–õ–¨
function getWorkWeeks(year, month) {
  const weeks = [];
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  
  let currentDate = new Date(firstDay);
  while (currentDate.getDay() !== 1 && currentDate <= lastDay) {
    currentDate.setDate(currentDate.getDate() + 1);
  }
  
  if (currentDate > lastDay) {
    currentDate = new Date(firstDay);
  }
  
  while (currentDate <= lastDay) {
    const weekStart = new Date(currentDate);
    let weekEnd = new Date(currentDate);
    weekEnd.setDate(weekEnd.getDate() + 6);
    
    if (weekEnd > lastDay) {
      weekEnd = new Date(lastDay);
    }
    
    weeks.push({
      start: new Date(weekStart),
      end: new Date(weekEnd)
    });
    
    currentDate.setDate(currentDate.getDate() + 7);
  }
  return weeks;
}

function loadWeekOptions() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –Ω–µ–¥–µ–ª—å
}

function loadMonthOptions() {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –º–µ—Å—è—Ü–µ–≤
}

function formatDate(date) {
  return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'numeric' });
}

function getWeekDays(start, end) {
  const days = [];
  const current = new Date(start);
  while (current <= end) {
    days.push(current.toLocaleDateString('ru-RU', { weekday: 'short' }));
    current.setDate(current.getDate() + 1);
  }
  return days.join(', ');
}

// üîß –ó–ê–í–ï–†–®–ï–ù–ò–ï –°–ö–†–ò–ü–¢–ê
</script>
</body>
</html>